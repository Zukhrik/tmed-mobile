{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{creatingPostMediaMount,creatingPostMount,deleteUnCreatedPostMediaMount,postMediaPercentCompletedMount,resetAllTapeWithTokenMount,resetPostMedia,tapeLikeMount,tapeRemoveLikesMount}from'./events';import{combine,createStore}from'effector';import{commonStoreList}from'../../utils/store-utils';import{fetchAllTape,fetchAuthorTape,fetchCreatingPost,fetchCreatingPostMedia,fetchDeletePost}from'./effects';import{subscribeToUserMount}from'../user-model';import{fetchSubscribeToUser}from'../user-model/effects';var $authorTape=createStore({loading:false,data:[],result:{},forceLoading:0,error:false}).on(fetchAuthorTape.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAuthorTape.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAuthorTape.done,function(state,_ref2){var result=_ref2.result,params=_ref2.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(tapeLikeMount,function(state,params){var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var oldData=data[author][idx];data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:true,likes_count:oldData.block_data.likes_count+1})})],_toConsumableArray(data[author].slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(tapeRemoveLikesMount,function(state,params){var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var oldData=data[author][idx];if(idx!==-1){data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:false,likes_count:oldData.block_data.likes_count-1})})],_toConsumableArray(data[author].slice(idx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchDeletePost.done,function(state,_ref3){var params=_ref3.params;var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});if(idx!==-1){data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),_toConsumableArray(data[author].slice(idx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(creatingPostMount,function(state,_ref4){var temp_data=_ref4.temp_data;var item_data=temp_data.item_data,author=temp_data.author;var data=_objectSpread({},state.data);var result=_objectSpread({},state.result);if(data[author]){data[author]=[item_data].concat(_toConsumableArray(data[author]));result[author]=_objectSpread(_objectSpread({},result[author]),{},{count:result[author].count+1});// if (action) {\n//     action()\n// }\n}return _objectSpread(_objectSpread({},state),{},{data:data,result:result});}).on(fetchCreatingPost.done,function(state,_ref5){var response=_ref5.result,temp_data=_ref5.params.temp_data;var author=temp_data.author,uuid=temp_data.uuid,action=temp_data.action;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return item.id===uuid;});var newItem=_objectSpread(_objectSpread({},data[author][idx]),response.data);data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[newItem],_toConsumableArray(data[author].slice(idx+1)));if(action){action(response.data.id);}}return _objectSpread(_objectSpread({},state),{},{data:data});});var $allTape=createStore({data:[],result:{},error:false,loading:false,forceLoading:0}).on(fetchAllTape.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAllTape.fail,function(state,_ref6){var error=_ref6.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAllTape.done,function(state,_ref7){var result=_ref7.result,params=_ref7.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(subscribeToUserMount,function(state,params){var username=params.username;var data=_toConsumableArray(state.data);var usersBlockIdx=data.findIndex(function(item){return item.block_type&&item.block_type==='users';});if(usersBlockIdx!==-1){var idx=data[usersBlockIdx].block_data.findIndex(function(item){return item.username===username;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[usersBlockIdx].block_data[idx]),{},{subs:{subscribed:true,me:data[usersBlockIdx].block_data[idx].subs.me+1}});var innerData=[].concat(_toConsumableArray(data[usersBlockIdx].block_data.slice(0,idx)),[item],_toConsumableArray(data[usersBlockIdx].block_data.slice(idx+1)));data=[].concat(_toConsumableArray(state.data.slice(0,usersBlockIdx)),[_objectSpread(_objectSpread({},data[usersBlockIdx]),{},{block_data:innerData})],_toConsumableArray(state.data.slice(usersBlockIdx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(tapeLikeMount,function(state,params){var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){var oldData=state.data[idx];newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:true,likes_count:oldData.block_data.likes_count+1})})],_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(tapeRemoveLikesMount,function(state,params){var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){var oldData=state.data[idx];newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:false,likes_count:oldData.block_data.likes_count-1})})],_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(fetchDeletePost.done,function(state,_ref8){var params=_ref8.params;var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(creatingPostMount,function(state,_ref9){var temp_data=_ref9.temp_data;var item_data=temp_data.item_data;// if (action) {\n//     action()\n// }\nvar result=_objectSpread(_objectSpread({},state.result),{},{count:state.result.count+1});var data=[item_data].concat(_toConsumableArray(state.data));return _objectSpread(_objectSpread({},state),{},{data:data,result:result});}).on(fetchCreatingPost.done,function(state,_ref10){var response=_ref10.result,temp_data=_ref10.params.temp_data;var uuid=temp_data.uuid,action=temp_data.action;var data=state.data;var idx=data.findIndex(function(item){return item.block_data.id===uuid;});if(idx!==-1){var newItem=_objectSpread(_objectSpread({},data[idx]),response.data);data=[].concat(_toConsumableArray(data.slice(0,idx)),[newItem],_toConsumableArray(data.slice(idx+1)));if(!!action){action(response.data.id);}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchSubscribeToUser.done,function(state,_ref11){var _ref11$params=_ref11.params,username=_ref11$params.username,action=_ref11$params.action;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_type)&&item.block_type==='users';});var usersData=state.data[idx];var accountIdx=usersData.block_data.findIndex(function(item){return item.username===username;});if(idx&&accountIdx!==-1){console.log(state.data[idx].block_data[accountIdx]);// newData = [...state.data.slice(0, idx),\n//     [...state.data[idx].block_data.slice(0, accountIdx),\n//         {...state.data[idx].block_data[accountIdx].subs, subscribed: true},\n//         ...state.data[idx].block_data.slice(accountIdx + 1)],\n//     ...state.data.slice(idx + 1)]\n}return _objectSpread({},state);}).reset(resetAllTapeWithTokenMount);var $postMedia=createStore({data:[],error:false}).on(creatingPostMediaMount,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:[].concat(_toConsumableArray(state.data),[payload.obj])});}).on(fetchCreatingPostMedia.done,function(state,_ref12){var result=_ref12.result,params=_ref12.params;var data=_toConsumableArray(state.data);var obj=params.obj;var idx=data.findIndex(function(item){return item.id===obj.id;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[idx]),{},{id:result.data.id,percentCompleted:100});data=[].concat(_toConsumableArray(data.slice(0,idx)),[item],_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(postMediaPercentCompletedMount,function(state,payload){var data=_toConsumableArray(state.data);var id=payload.id,percentCompleted=payload.percentCompleted;var idx=data.findIndex(function(item){return item.id===id;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[idx]),{},{percentCompleted:percentCompleted===100?99:percentCompleted});data=[].concat(_toConsumableArray(data.slice(0,idx)),[item],_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(deleteUnCreatedPostMediaMount,function(state,params){var id=params.media_id;var data=state.data;var idx=data.findIndex(function(item){return item.id===id;});if(idx!==-1){data=[].concat(_toConsumableArray(data.slice(0,idx)),_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).reset(resetPostMedia);export var $tapeModel=combine({$authorTape:$authorTape,$allTape:$allTape,$postMedia:$postMedia});","map":null,"metadata":{},"sourceType":"module"}