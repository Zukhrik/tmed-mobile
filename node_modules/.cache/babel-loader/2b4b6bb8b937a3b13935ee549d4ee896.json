{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import moment from'moment';import{useCallback,useEffect,useState}from'react';import{useUrlParams}from'../app';import{URL_KEYS}from'../../Constants';import{useStore}from'effector-react';import{formatter,strHourToInt}from'./use-specialist-date';import{getDateTime,getWeekDay}from'../../utils/time-utils';import{$orderModel}from'../../Models/order-model';import order from'../../Service/order';import{useHistory,useParams}from'react-router-dom';export function useSpecMeetDate(_ref){var _data$organization$,_data$organization$$r;var activeDay=_ref.activeDay;var _useParams=useParams(),organization=_useParams.organization;var _useState=useState(new Date()),_useState2=_slicedToArray(_useState,1),activeDate=_useState2[0];var _useHistory=useHistory(),push=_useHistory.push,pathname=_useHistory.location.pathname;var _useStore=useStore($orderModel),data=_useStore.$orgOrderCartList.data;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dateRange=_useState4[0],setDateRange=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),meetTimes=_useState6[0],setMeetTimes=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),hours=_useState8[0],setHours=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),procInterval=_useState10[0],setProcInterval=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),requestData=_useState12[0],setRequestData=_useState12[1];var operating_modes=organization&&data[organization]&&((_data$organization$=data[organization][0])===null||_data$organization$===void 0?void 0:(_data$organization$$r=_data$organization$.responsible)===null||_data$organization$$r===void 0?void 0:_data$organization$$r.operating_mode);var _useUrlParams=useUrlParams(),urlData=_useUrlParams.urlData;var specId=urlData[URL_KEYS.SPECIALIST_ID];var generateData=useCallback(function(data){var tmp={};for(var i=0;i<data.length;i++){var id=new Date(moment(data[i].meet_date).format(formatter)).getTime();var meetTime=moment(data[i].meet_date).format('HH.mm');tmp[id]={user:data[i].user,meetTime:parseFloat(parseFloat(meetTime).toFixed(1))};}return tmp;},[]);var getOrgOrder=useCallback(function(params){order.getOrgOrderResponsible(params).then(function(res){var data=res.data.results;var orders=generateData(data);setRequestData(orders);});},[generateData]);var renderMeetRow=useCallback(function(id){var strHour=moment(id).format('HH:mm');var hourInt=strHourToInt(strHour);return meetTimes[hourInt]&&Object.values(meetTimes[hourInt]).sort(function(a,b){return a-b;});},[meetTimes]);var generateMeetTimeLink=useCallback(function(){var url=[];if(specId){url.push(\"\".concat(URL_KEYS.SPECIALIST_ID,\"=\").concat(specId));}url.push(\"\".concat(URL_KEYS.DATE,\"=\").concat(activeDay));url.push(\"\".concat(URL_KEYS.TIME,\"=00:00:00\"));return{pathname:pathname,search:url.join('&')};},[activeDay,pathname,specId]);useEffect(function(){var endDate=moment(activeDate).endOf('month');var start=activeDate.getUTCDate();var end=new Date(endDate).getUTCDate();var tmp=[];for(var i=0;i<=end-start;i++){var d=moment(activeDate).add(i,'days');tmp.push(d.format('YYYY-MM-DD'));}setDateRange(tmp);},[activeDate]);useEffect(function(){var day=getWeekDay(new Date());if(operating_modes&&operating_modes[day]){var mode=operating_modes[day];var breaks=mode.breaks;var to=mode.to;var interval=mode.proc_interval;var tmp=[];var possibleMeetTime={};var from=parseInt(mode.from);var a=mode.from;var date=new Date(activeDay);if(interval!==0){while(a<to){for(var i=0;i<breaks.length;i++){if(parseInt(a)===parseInt(breaks[i].from)&&(breaks[i].from>=a||a<breaks[i].to)){a=breaks[i].to;}}possibleMeetTime[parseInt(a)]=possibleMeetTime[parseInt(a)]?_objectSpread({},possibleMeetTime[parseInt(a)]):{};var strHour=moment(new Date(new Date(getDateTime(a)).setMinutes(new Date(getDateTime(a===from?mode.from:a)).getMinutes()+interval)));var id=moment(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).format(formatter);possibleMeetTime[parseInt(a)][id]={intDate:a,strDate:\"\".concat(moment(getDateTime(a)).format('HH:mm'),\" - \").concat(strHour.format('HH:mm')),dateTime:new Date(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).getTime()};a=parseFloat(strHour.format('HH.mm'));}setMeetTimes(possibleMeetTime);for(var _i=from;_i<to;_i++){var _id=new Date(new Date(\"\".concat(date.toDateString(),\" 0\").concat(_i,\":59\"))).getTime();if(_i<10){tmp.push({hour:\"0\".concat(_i,\":00\"),interval:interval,id:_id});}else{tmp.push({hour:\"\".concat(_i,\":00\"),interval:interval,id:_id});}}setHours(tmp);}else{setProcInterval(true);}}},[operating_modes,activeDay]);useEffect(function(){if(specId&&activeDay){var _data={responsible_id:specId,params:{status:'0,1,2',limit:200,offset:0,meet_date__gt:moment(new Date(\"\".concat(new Date(activeDay).toDateString(),\" 00:00\"))).format(formatter),meet_date__lt:moment(new Date(\"\".concat(new Date(activeDay).toDateString(),\" 23:59\"))).format(formatter)}};getOrgOrder(_data);}},[specId,getOrgOrder,activeDay]);useEffect(function(){if(procInterval){push(generateMeetTimeLink());}},[procInterval,generateMeetTimeLink,push]);return{dateRange:dateRange,activeDate:activeDate,hours:hours,renderMeetRow:renderMeetRow,requestData:requestData};}","map":null,"metadata":{},"sourceType":"module"}