{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import moment from'moment';import{useCallback,useEffect,useState}from'react';import{useUrlParams}from'../app';import{URL_KEYS}from'../../Constants';import{useStore}from'effector-react';import{formatter,strHourToInt}from'./use-specialist-date';import{getDateTime,getWeekDay}from'../../utils/time-utils';import{$orderModel}from'../../Models/order-model';import order from'../../Service/order';import{useHistory,useParams}from'react-router-dom';export function useSpecMeetDate(_ref){var _data$organization$,_data$organization$$r;var activeDay=_ref.activeDay;var _useParams=useParams(),organization=_useParams.organization;var _useState=useState(new Date()),_useState2=_slicedToArray(_useState,1),activeDate=_useState2[0];var _useHistory=useHistory(),push=_useHistory.push,pathname=_useHistory.location.pathname;var _useStore=useStore($orderModel),data=_useStore.$orgOrderCartList.data;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dateRange=_useState4[0],setDateRange=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),meetTimes=_useState6[0],setMeetTimes=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),hours=_useState8[0],setHours=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),procInterval=_useState10[0],setProcInterval=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),requestData=_useState12[0],setRequestData=_useState12[1];var operating_modes=organization&&data[organization]&&((_data$organization$=data[organization][0])===null||_data$organization$===void 0?void 0:(_data$organization$$r=_data$organization$.responsible)===null||_data$organization$$r===void 0?void 0:_data$organization$$r.operating_mode);var _useUrlParams=useUrlParams(),urlData=_useUrlParams.urlData;var specId=urlData[URL_KEYS.SPECIALIST_ID];var generateData=useCallback(function(data){var tmp={};for(var i=0;i<data.length;i++){var id=new Date(moment(data[i].meet_date).format(formatter)).getTime();var meetTime=moment(data[i].meet_date).format('HH.mm');tmp[id]={user:data[i].user,meetTime:parseFloat(parseFloat(meetTime).toFixed(1))};}return tmp;},[]);var getOrgOrder=useCallback(function(params){order.getOrgOrderResponsible(params).then(function(res){var data=res.data.results;var orders=generateData(data);setRequestData(orders);});},[generateData]);var renderMeetRow=useCallback(function(id){var strHour=moment(id).format('HH:mm');var hourInt=strHourToInt(strHour);return meetTimes[hourInt]&&Object.values(meetTimes[hourInt]).sort(function(a,b){return a-b;});},[meetTimes]);var generateMeetTimeLink=useCallback(function(){var url=[];if(specId){url.push(\"\".concat(URL_KEYS.SPECIALIST_ID,\"=\").concat(specId));}url.push(\"\".concat(URL_KEYS.DATE,\"=\").concat(activeDay));url.push(\"\".concat(URL_KEYS.TIME,\"=00:00:00\"));return{pathname:pathname,search:url.join('&')};},[activeDay,pathname,specId]);useEffect(function(){var endDate=moment(activeDate).endOf('month');var start=activeDate.getUTCDate();var end=new Date(endDate).getUTCDate();var tmp=[];for(var i=0;i<=end-start;i++){var d=moment(activeDate).add(i,'days');tmp.push(d.format('YYYY-MM-DD'));}setDateRange(tmp);},[activeDate]);useEffect(function(){var day=getWeekDay(new Date());if(operating_modes&&operating_modes[day]){var mode=operating_modes[day];var breaks=mode.breaks;var to=mode.to;var interval=mode.proc_interval;var tmp=[];var possibleMeetTime={};var from=parseInt(mode.from);var a=mode.from;var date=new Date(activeDay);if(interval!==0){while(a<to){for(var i=0;i<breaks.length;i++){if(parseInt(a)===parseInt(breaks[i].from)&&(breaks[i].from>=a||a<breaks[i].to)){a=breaks[i].to;}}possibleMeetTime[parseInt(a)]=possibleMeetTime[parseInt(a)]?_objectSpread({},possibleMeetTime[parseInt(a)]):{};var strHour=moment(new Date(new Date(getDateTime(a)).setMinutes(new Date(getDateTime(a===from?mode.from:a)).getMinutes()+interval)));var id=moment(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).format(formatter);possibleMeetTime[parseInt(a)][id]={intDate:a,strDate:\"\".concat(moment(getDateTime(a)).format('HH:mm'),\" - \").concat(strHour.format('HH:mm')),dateTime:new Date(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).getTime()};a=parseFloat(strHour.format('HH.mm'));}setMeetTimes(possibleMeetTime);for(var _i=from;_i<to;_i++){var _id=new Date(new Date(\"\".concat(date.toDateString(),\" 0\").concat(_i,\":59\"))).getTime();if(_i<10){tmp.push({hour:\"0\".concat(_i,\":00\"),interval:interval,id:_id});}else{tmp.push({hour:\"\".concat(_i,\":00\"),interval:interval,id:_id});}}setHours(tmp);}else{setProcInterval(true);}}},[operating_modes,activeDay]);useEffect(function(){if(specId&&activeDay){var _data={responsible_id:specId,params:{status:'0,1,2',limit:200,offset:0,meet_date__gt:moment(new Date(\"\".concat(new Date(activeDay).toDateString(),\" 00:00\"))).format(formatter),meet_date__lt:moment(new Date(\"\".concat(new Date(activeDay).toDateString(),\" 23:59\"))).format(formatter)}};getOrgOrder(_data);}},[specId,getOrgOrder,activeDay]);useEffect(function(){if(procInterval){push(generateMeetTimeLink());}},[procInterval,generateMeetTimeLink,push]);return{dateRange:dateRange,activeDate:activeDate,hours:hours,renderMeetRow:renderMeetRow,requestData:requestData};}","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Hooks/checkout/use-spec-meet-date.js"],"names":["moment","useCallback","useEffect","useState","useUrlParams","URL_KEYS","useStore","formatter","strHourToInt","getDateTime","getWeekDay","$orderModel","order","useHistory","useParams","useSpecMeetDate","activeDay","organization","Date","activeDate","push","pathname","location","data","$orgOrderCartList","dateRange","setDateRange","meetTimes","setMeetTimes","hours","setHours","procInterval","setProcInterval","requestData","setRequestData","operating_modes","responsible","operating_mode","urlData","specId","SPECIALIST_ID","generateData","tmp","i","length","id","meet_date","format","getTime","meetTime","user","parseFloat","toFixed","getOrgOrder","params","getOrgOrderResponsible","then","res","results","orders","renderMeetRow","strHour","hourInt","Object","values","sort","a","b","generateMeetTimeLink","url","DATE","TIME","search","join","endDate","endOf","start","getUTCDate","end","d","add","day","mode","breaks","to","interval","proc_interval","possibleMeetTime","from","parseInt","date","setMinutes","getMinutes","toDateString","intDate","strDate","dateTime","hour","responsible_id","status","limit","offset","meet_date__gt","meet_date__lt"],"mappings":"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","sourcesContent":["import moment from 'moment'\nimport {useCallback, useEffect, useState} from 'react'\nimport {useUrlParams} from '../app'\nimport {URL_KEYS} from '../../Constants'\nimport {useStore} from 'effector-react'\nimport {formatter, strHourToInt} from './use-specialist-date'\nimport {getDateTime, getWeekDay} from '../../utils/time-utils'\nimport {$orderModel} from '../../Models/order-model'\nimport order from '../../Service/order'\nimport {useHistory, useParams} from 'react-router-dom'\n\nexport function useSpecMeetDate({activeDay}) {\n    const {organization} = useParams()\n    const [activeDate] = useState(new Date())\n    const {push, location: {pathname}} = useHistory()\n    const {$orgOrderCartList: {data}} = useStore($orderModel)\n    const [dateRange, setDateRange] = useState([])\n    const [meetTimes, setMeetTimes] = useState({})\n    const [hours, setHours] = useState([])\n    const [procInterval, setProcInterval] = useState(false)\n    const [requestData, setRequestData] = useState({})\n    const operating_modes = organization && data[organization] && data[organization][0]?.responsible?.operating_mode\n    const {urlData} = useUrlParams()\n    const specId = urlData[URL_KEYS.SPECIALIST_ID]\n    \n    const generateData = useCallback((data) => {\n        const tmp = {}\n        for (let i = 0; i < data.length; i++) {\n            const id = new Date(moment(data[i].meet_date).format(formatter)).getTime()\n            const meetTime = moment(data[i].meet_date).format('HH.mm')\n            tmp[id] = {\n                user: data[i].user,\n                meetTime: parseFloat(parseFloat(meetTime).toFixed(1))\n            }\n        }\n        return tmp\n    }, [])\n    \n    const getOrgOrder = useCallback((params) => {\n        order.getOrgOrderResponsible(params)\n            .then(res => {\n                const data = res.data.results\n                let orders = generateData(data)\n                setRequestData(orders)\n            })\n    }, [generateData])\n    \n    const renderMeetRow = useCallback((id) => {\n        const strHour = moment(id).format('HH:mm')\n        const hourInt = strHourToInt(strHour)\n        return meetTimes[hourInt] && Object.values(meetTimes[hourInt]).sort((a, b) => a - b)\n    }, [meetTimes])\n    \n    const generateMeetTimeLink = useCallback(() => {\n        const url = []\n        if (specId) {\n            url.push(`${URL_KEYS.SPECIALIST_ID}=${specId}`)\n        }\n        url.push(`${URL_KEYS.DATE}=${activeDay}`)\n        url.push(`${URL_KEYS.TIME}=00:00:00`)\n        return {\n            pathname,\n            search: url.join('&')\n        }\n    }, [activeDay, pathname, specId])\n    \n    useEffect(() => {\n        const endDate = moment(activeDate).endOf('month')\n        let start = activeDate.getUTCDate()\n        const end = new Date(endDate).getUTCDate()\n        const tmp = []\n        for (let i = 0; i <= end - start; i++) {\n            const d = moment(activeDate).add(i, 'days')\n            tmp.push(d.format('YYYY-MM-DD'))\n        }\n        \n        setDateRange(tmp)\n    }, [activeDate])\n    \n    \n    useEffect(() => {\n        const day = getWeekDay(new Date())\n        if (operating_modes && operating_modes[day]) {\n            const mode = operating_modes[day]\n            const breaks = mode.breaks\n            const to = mode.to\n            const interval = mode.proc_interval\n            const tmp = []\n            const possibleMeetTime = {}\n            let from = parseInt(mode.from)\n            let a = mode.from\n            const date = new Date(activeDay)\n            \n            if (interval !== 0) {\n                while (a < to) {\n                    \n                    for (let i = 0; i < breaks.length; i++) {\n                        if (parseInt(a) === parseInt(breaks[i].from) && (breaks[i].from >= a || a < breaks[i].to)) {\n                            a = breaks[i].to\n                        }\n                    }\n                    \n                    possibleMeetTime[parseInt(a)] = possibleMeetTime[parseInt(a)]\n                        ? {...possibleMeetTime[parseInt(a)]}\n                        : {}\n                    \n                    const strHour = moment(new Date(new Date(getDateTime(a))\n                        .setMinutes(new Date(getDateTime(a === from ? mode.from : a)).getMinutes() + interval)))\n                    \n                    const id = moment(new Date(`${date.toDateString()} ${moment(getDateTime(a)).format('HH:mm')}`)).format(formatter)\n                    \n                    possibleMeetTime[parseInt(a)][id] = {\n                        intDate: a,\n                        strDate: `${moment(getDateTime(a)).format('HH:mm')} - ${strHour.format('HH:mm')}`,\n                        dateTime: new Date(new Date(`${date.toDateString()} ${moment(getDateTime(a)).format('HH:mm')}`)).getTime()\n                    }\n                    a = parseFloat(strHour.format('HH.mm'))\n                }\n                setMeetTimes(possibleMeetTime)\n                for (let i = from; i < to; i++) {\n                    const id = new Date(new Date(`${date.toDateString()} 0${i}:59`)).getTime()\n                    if (i < 10) {\n                        tmp.push({hour: `0${i}:00`, interval, id})\n                    } else {\n                        tmp.push({hour: `${i}:00`, interval, id})\n                    }\n                }\n                setHours(tmp)\n            } else {\n                setProcInterval(true)\n            }\n        }\n    }, [operating_modes, activeDay])\n    \n    \n    useEffect(() => {\n        if (specId && activeDay) {\n            const data = {\n                responsible_id: specId,\n                params: {\n                    status: '0,1,2',\n                    limit: 200,\n                    offset: 0,\n                    meet_date__gt: moment(new Date(`${new Date(activeDay).toDateString()} 00:00`)).format(formatter),\n                    meet_date__lt: moment(new Date(`${new Date(activeDay).toDateString()} 23:59`)).format(formatter)\n                }\n            }\n            getOrgOrder(data)\n        }\n    }, [specId, getOrgOrder, activeDay])\n    \n    useEffect(() => {\n        if (procInterval) {\n            push(generateMeetTimeLink())\n        }\n    }, [procInterval, generateMeetTimeLink, push])\n    \n    return {dateRange, activeDate, hours, renderMeetRow, requestData}\n}"]},"metadata":{},"sourceType":"module"}