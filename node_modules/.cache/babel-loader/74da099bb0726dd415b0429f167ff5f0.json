{"ast":null,"code":"import{useCallback}from'react';import{useListQuery,useUrlParams}from'../app';import{useStore}from'effector-react';import order from'../../Service/order';import{useParams}from'react-router-dom';import{$appModel}from'../../Models/app';import{$accountModel}from'../../Models/account-model';import{getOrgOrderCartsMount}from'../../Models/order-model';import{useMutation}from'react-query';import{queryClient}from'../../App';export function useOrgOrder(){var _useListQuery=useListQuery(),query=_useListQuery.query;var _useParams=useParams(),organization=_useParams.organization;var _useStore=useStore($appModel),$detectLocationInfo=_useStore.$detectLocationInfo;var _useUrlParams=useUrlParams(),specId=_useUrlParams.urlData.specialist_id;var _useStore2=useStore($accountModel),currentProfile=_useStore2.$profiles.currentProfile;var currency=currentProfile?currentProfile.currency.code:$detectLocationInfo.currency||'';// const checkoutOffering = useCallback((event) => {\n//     const orgSpecList = event.responsible\n//\n//     if (!event.loading) {\n//         changeLoadingStatusOffering({id: event.id, status: true})\n//         if (!event.inCart) {\n//             const params = {\n//                 org_slug_name: event.organization,\n//                 data: {\n//                     offering_id: event.id,\n//                     responsible_id: specId ? specId : orgSpecList[0].id\n//                 }\n//             }\n//             order.postOrgOrderCart(params)\n//                 .then((res) => {\n//                     if (res) {\n//                         saveURLMount(pathname)\n//                         changeOrgOfferingStatus({\n//                             offering_id: params.data.offering_id,\n//                             status: true,\n//                             loadingStatus: false\n//                         })\n//                         getOrgOrderCartsMount({\n//                             org_slug_name: event.organization,\n//                             params: {limit: 1, offset: 0},\n//                             clear: true\n//                         })\n//                     }\n//                 })\n//                 .catch((e) => {\n//                     console.log(e.response)\n//                 })\n//         } else {\n//             order.deleteOrderCart({offering_id: event.id})\n//                 .then((res) => {\n//                     if (res) {\n//                         changeOrgOfferingStatus({offering_id: event.id, status: false, loadingStatus: false})\n//                         getOrgOrderCartsMount({\n//                             org_slug_name: event.organization,\n//                             params: {limit: 1, offset: 0},\n//                             clear: true\n//                         })\n//                     }\n//                 })\n//                 .catch((e) => {\n//                     console.log(e.response)\n//                 })\n//         }\n//     }\n//\n// }, [specId, pathname])\nvar create=useMutation(order.postOrgOrderCart,{onMutate:function onMutate(itemInfo){queryClient.cancelQueries(['/org/offerings',organization]);var _queryClient$getQuery=queryClient.getQueryData(['/org/offerings',organization,query]),pages=_queryClient$getQuery.pages;queryClient.setQueryData(['/org/offerings',organization]);return function(){return queryClient.setQueryData(['/org/offerings',organization],pages);};},onSuccess:function onSuccess(){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});},onError:function onError(err,itemId,rollback){return rollback();},onSettled:function onSettled(itemInfo){queryClient.invalidateQueries(['/org/offerings',organization]);}});var remove=useMutation(order.deleteOrderCart,{onMutate:function onMutate(itemInfo){queryClient.cancelQueries(['/org/offerings',organization]);var previousTodo=queryClient.getQueryData(['/org/offerings',organization,query]);queryClient.setQueryData(['/org/offerings',organization]);return function(){return queryClient.setQueryData(['/org/offerings',organization,query],previousTodo);};},onSuccess:function onSuccess(){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});},onError:function onError(err,newData,rollback){return rollback();},onSettled:function onSettled(itemInfo){queryClient.invalidateQueries(['/org/offerings',organization,query]).then(function(res){if(res){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});}});}});var onCreatingCartItem=useCallback(function(event){var orgSpecList=event.responsible;if(event.inCart){remove.mutate({offering_id:event.id});}else{var params={org_slug_name:event.organization,data:{offering_id:event.id,responsible_id:specId?specId:orgSpecList[0].id}};create.mutate(params);}},[create,specId,remove]);var getIsLoading=useCallback(function(id){var _create$variables,_create$variables$dat,_remove$variables;if(create.isLoading&&(create===null||create===void 0?void 0:(_create$variables=create.variables)===null||_create$variables===void 0?void 0:(_create$variables$dat=_create$variables.data)===null||_create$variables$dat===void 0?void 0:_create$variables$dat.offering_id)===id){return true;}else if(remove.isLoading&&(remove===null||remove===void 0?void 0:(_remove$variables=remove.variables)===null||_remove$variables===void 0?void 0:_remove$variables.offering_id)===id){return true;}return false;},[create,remove]);return{currency:currency,create:create,remove:remove,getIsLoading:getIsLoading,onCreatingCartItem:onCreatingCartItem};}","map":null,"metadata":{},"sourceType":"module"}