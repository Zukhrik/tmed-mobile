{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as Yup from'yup';import Cookies from'js-cookie';import{useFormik}from'formik';import jwtDecode from'jwt-decode';import auth from'../../Service/auth';import{useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{AsYouType}from'libphonenumber-js';import{tokenMount}from'../../Models/app';import{useTranslation}from'react-i18next';import{getCurrentAccount}from'../../Models/account-model';export var usePhoneVerify=function usePhoneVerify(){var _useState=useState(Date.now()+1000*60),_useState2=_slicedToArray(_useState,2),deadline=_useState2[0],setDeadline=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showResend=_useState4[0],setShowResend=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),phone=_useState6[0],setPhone=_useState6[1];var _useHistory=useHistory(),location=_useHistory.location,push=_useHistory.push;var _useTranslation=useTranslation(),t=_useTranslation.t;var validationSchema=Yup.object().shape({activation_code:Yup.string().required(t('required_field')).test('regexTest',t('required_field'),function(value){return value&&value.match(/^(\\d\\s*){6}$/);})});var formik=useFormik({initialValues:{activation_code:''},validationSchema:validationSchema,onSubmit:function onSubmit(_ref){var activation_code=_ref.activation_code;auth.activateCode({activation_code:activation_code.replace(/\\s/g,'')}).then(function(res){if(res){var users={};if(Cookies.get('users')){var oldUsers=JSON.parse(Cookies.get('users'));users=_objectSpread({},oldUsers);}users[jwtDecode(res.data.access).username]=res.data;tokenMount(res.data.access);Cookies.set('users',JSON.stringify(users));Cookies.set('token',res.data.access);Cookies.set('refresh-token',res.data.refresh);getCurrentAccount();push('/');}});}});useEffect(function(){if(location.state&&location.state.phone){var p=new AsYouType('UZ').input(location.state.phone);setPhone(p);}},[location.state]);var onFinish=function onFinish(){setShowResend(true);};var resend=function resend(){if(location.state.phone){auth.resendCode({phone:\"+\".concat(location.state.phone)}).then(function(){setDeadline(Date.now()+1000*60);setShowResend(false);});}};return{phone:phone,formik:formik,resend:resend,deadline:deadline,onFinish:onFinish,showResend:showResend};};","map":null,"metadata":{},"sourceType":"module"}