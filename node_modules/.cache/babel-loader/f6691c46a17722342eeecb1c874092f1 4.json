{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{combine,createStore}from'effector';import{fetchAllUsers,fetchRecommendUsers,fetchSubscribeToUser,fetchUnsubscribeFromUser,fetchUser,fetchUserSubsMe,fetchUserSubsMy}from'./effects';import{idbSet}from'../../Config/db';import{onlineUserMount,onlineUserMountFromIDB,subscribeToRecommendUserMount,unsubscribeFromFallsMount}from'./events';import{changeSingleItemInArray,commonStoreList,storeWithKey}from'../../utils/store-utils';var $allUserList=createStore({loading:false,data:[],result:{},forceLoading:0,error:false}).on(fetchAllUsers.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAllUsers.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAllUsers.done,function(state,_ref2){var result=_ref2.result,params=_ref2.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(fetchSubscribeToUser.done,function(state,_ref3){var params=_ref3.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me+1,subscribed:true}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(fetchUnsubscribeFromUser.done,function(state,_ref4){var params=_ref4.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me-1,subscribed:false}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});});var $user=createStore({loading:false,data:{},error:{},forceLoading:0}).on(fetchUser.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUser.fail,function(state,_ref5){var error=_ref5.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUser.done,function(state,_ref6){var result=_ref6.result,key=_ref6.params,clear=_ref6.clear;var processed=storeWithKey({response:result.data,state:state,key:key,clear:clear});return _objectSpread(_objectSpread({},processed),{},{forceLoading:2});}).on(fetchSubscribeToUser.done,function(state,_ref7){var _ref7$params=_ref7.params,username=_ref7$params.username,action=_ref7$params.action;var data=_objectSpread({},state.data);if(username&&data[username]){data[username]=_objectSpread(_objectSpread({},data[username]),{},{subs:_objectSpread(_objectSpread({},data[username].subs),{},{subscribed:true})});if(action){action();}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchUnsubscribeFromUser.done,function(state,_ref8){var _ref8$params=_ref8.params,username=_ref8$params.username,action=_ref8$params.action;var data=_objectSpread({},state.data);if(username&&data[username]){data[username]=_objectSpread(_objectSpread({},data[username]),{},{subs:_objectSpread(_objectSpread({},data[username].subs),{},{subscribed:false})});if(action){action();}}return _objectSpread(_objectSpread({},state),{},{data:data});});var $userSubsMe=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchUserSubsMe.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUserSubsMe.fail,function(state,_ref9){var error=_ref9.error;return _objectSpread(_objectSpread({},state),{},{error:error,result:{},data:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUserSubsMe.done,function(state,_ref10){var result=_ref10.result,params=_ref10.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});});var $userSubsMy=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchUserSubsMy.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUserSubsMy.fail,function(state,_ref11){var error=_ref11.error;return _objectSpread(_objectSpread({},state),{},{error:error,result:{},data:[],forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUserSubsMy.done,function(state,_ref12){var result=_ref12.result,params=_ref12.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(unsubscribeFromFallsMount,function(state,_ref13){var username=_ref13.username;var data=_toConsumableArray(state.data);var idx=data.findIndex(function(item){return!item.to_org?item.to_user.username===username:item.to_org.slug_name===username;});if(idx!==-1){data=[].concat(_toConsumableArray(data.slice(0,idx)),_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});});var $recommendUsers=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchRecommendUsers.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchRecommendUsers.fail,function(state,_ref14){var error=_ref14.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchRecommendUsers.done,function(state,_ref15){var result=_ref15.result,params=_ref15.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear,key:params.username},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(subscribeToRecommendUserMount,function(state,_ref16){var username=_ref16.username;var idx=state.data.findIndex(function(item){return item.username===username;});if(idx!==-1){// data = [...data.slice(0, idx), {\n//     ...data[idx].subs, subscribed: true\n// }, ...data.slice(idx + 1)]\n}return _objectSpread({},state);}).on(fetchSubscribeToUser.done,function(state,_ref17){var params=_ref17.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me+1,subscribed:true}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});});var $onlineUser=createStore({data:{}}).on(onlineUserMount,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:_objectSpread(_objectSpread({},state.data),payload)});}).on(onlineUserMountFromIDB,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:_objectSpread(_objectSpread({},state.data),payload)});});$onlineUser.watch(function(state){if(Object.values(state.data).length>0){idbSet('online_accounts','online_accounts',JSON.stringify(state.data)).then(function(){});}});export var $userModel=combine({$user:$user,$userSubsMe:$userSubsMe,$userSubsMy:$userSubsMy,$allUserList:$allUserList,$onlineUser:$onlineUser,$recommendUsers:$recommendUsers});","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Models/user-model/stores.js"],"names":["combine","createStore","fetchAllUsers","fetchRecommendUsers","fetchSubscribeToUser","fetchUnsubscribeFromUser","fetchUser","fetchUserSubsMe","fetchUserSubsMy","idbSet","onlineUserMount","onlineUserMountFromIDB","subscribeToRecommendUserMount","unsubscribeFromFallsMount","changeSingleItemInArray","commonStoreList","storeWithKey","$allUserList","loading","data","result","forceLoading","error","on","pending","state","fail","done","params","processed","response","clear","getOldData","oldData","subs","me","subscribed","newData","arr","key","value","username","option","$user","action","$userSubsMe","$userSubsMy","idx","findIndex","item","to_org","to_user","slug_name","slice","$recommendUsers","$onlineUser","payload","watch","Object","values","length","JSON","stringify","then","$userModel"],"mappings":"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","sourcesContent":["import {combine, createStore} from 'effector'\r\nimport {\r\n    fetchAllUsers,\r\n    fetchRecommendUsers,\r\n    fetchSubscribeToUser,\r\n    fetchUnsubscribeFromUser,\r\n    fetchUser,\r\n    fetchUserSubsMe,\r\n    fetchUserSubsMy\r\n} from './effects'\r\nimport {idbSet} from '../../Config/db'\r\nimport {\r\n    onlineUserMount,\r\n    onlineUserMountFromIDB,\r\n    subscribeToRecommendUserMount,\r\n    unsubscribeFromFallsMount\r\n} from './events'\r\nimport {changeSingleItemInArray, commonStoreList, storeWithKey} from '../../utils/store-utils'\r\n\r\nconst $allUserList = createStore({loading: false, data: [], result: {}, forceLoading: 0, error: false})\r\n    .on(fetchAllUsers.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAllUsers.fail, (state, {error}) => ({\r\n        ...state, error, data: [], result: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchAllUsers.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, ...params.params\r\n        })\r\n        return {\r\n            ...state, ...processed, forceLoading: 2\r\n        }\r\n    })\r\n    .on(fetchSubscribeToUser.done, (state, {params}) => {\r\n        const getOldData = (oldData) => ({subs: {me: oldData.subs.me + 1, subscribed: true}})\r\n        \r\n        const newData = changeSingleItemInArray({\r\n            arr: state.data,\r\n            key: 'username',\r\n            value: params.username,\r\n            getOldData\r\n        })\r\n        \r\n        if (params.option) {\r\n            params.option()\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            data: newData\r\n        }\r\n    })\r\n    .on(fetchUnsubscribeFromUser.done, (state, {params}) => {\r\n        const getOldData = (oldData) => ({subs: {me: oldData.subs.me - 1, subscribed: false}})\r\n        \r\n        const newData = changeSingleItemInArray({\r\n            arr: state.data,\r\n            key: 'username',\r\n            value: params.username,\r\n            getOldData\r\n        })\r\n        \r\n        if (params.option) {\r\n            params.option()\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            data: newData\r\n        }\r\n    })\r\n\r\nconst $user = createStore({loading: false, data: {}, error: {}, forceLoading: 0})\r\n    .on(fetchUser.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchUser.fail, (state, {error}) => ({\r\n        ...state, error, data: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchUser.done, (state, {result, params: key, clear}) => {\r\n        const processed = storeWithKey({\r\n            response: result.data, state, key, clear: clear\r\n        })\r\n        \r\n        return {...processed, forceLoading: 2}\r\n    })\r\n    .on(fetchSubscribeToUser.done, (state, {params: {username, action}}) => {\r\n        const data = {...state.data}\r\n        if (username && data[username]) {\r\n            data[username] = {...data[username], subs: {...data[username].subs, subscribed: true}}\r\n            if (action) {\r\n                action()\r\n            }\r\n        }\r\n        return {...state, data}\r\n    })\r\n    .on(fetchUnsubscribeFromUser.done, (state, {params: {username, action}}) => {\r\n        const data = {...state.data}\r\n        if (username && data[username]) {\r\n            data[username] = {...data[username], subs: {...data[username].subs, subscribed: false}}\r\n            if (action) {\r\n                action()\r\n            }\r\n        }\r\n        return {...state, data}\r\n    })\r\n\r\nconst $userSubsMe = createStore({loading: false, data: [], result: {}, error: false, forceLoading: 0})\r\n    .on(fetchUserSubsMe.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchUserSubsMe.fail, (state, {error}) => ({\r\n        ...state, error, result: {}, data: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchUserSubsMe.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, ...params.params\r\n        })\r\n        return {\r\n            ...state, ...processed, forceLoading: 2\r\n        }\r\n    })\r\n\r\nconst $userSubsMy = createStore({loading: false, data: [], result: {}, error: false, forceLoading: 0})\r\n    .on(fetchUserSubsMy.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchUserSubsMy.fail, (state, {error}) => ({\r\n        ...state, error, result: {}, data: [], forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchUserSubsMy.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, ...params.params\r\n        })\r\n        \r\n        return {\r\n            ...state,\r\n            ...processed,\r\n            forceLoading: 2\r\n        }\r\n    })\r\n    .on(unsubscribeFromFallsMount, (state, {username}) => {\r\n        let data = [...state.data]\r\n        const idx = data.findIndex(\r\n            item =>\r\n                !item.to_org\r\n                    ? item.to_user.username === username\r\n                    : item.to_org.slug_name === username\r\n        )\r\n        \r\n        if (idx !== -1) {\r\n            data = [...data.slice(0, idx), ...data.slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state, data: data}\r\n    })\r\n\r\nconst $recommendUsers = createStore({loading: false, data: [], result: {}, error: false, forceLoading: 0})\r\n    .on(fetchRecommendUsers.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchRecommendUsers.fail, (state, {error}) => ({\r\n        ...state, error, data: [], result: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchRecommendUsers.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, key: params.username, ...params.params\r\n        })\r\n        \r\n        return {...state, ...processed, forceLoading: 2}\r\n    })\r\n    .on(subscribeToRecommendUserMount, (state, {username}) => {\r\n        const idx = state.data.findIndex(item => item.username === username)\r\n        \r\n        if (idx !== -1) {\r\n            // data = [...data.slice(0, idx), {\r\n            //     ...data[idx].subs, subscribed: true\r\n            // }, ...data.slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state}\r\n    })\r\n    .on(fetchSubscribeToUser.done, (state, {params}) => {\r\n        const getOldData = (oldData) => ({subs: {me: oldData.subs.me + 1, subscribed: true}})\r\n        \r\n        const newData = changeSingleItemInArray({\r\n            arr: state.data,\r\n            key: 'username',\r\n            value: params.username,\r\n            getOldData\r\n        })\r\n        \r\n        if (params.option) {\r\n            params.option()\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            data: newData\r\n        }\r\n    })\r\n\r\nconst $onlineUser = createStore({data: {}})\r\n    .on(onlineUserMount, (state, payload) => ({...state, data: {...state.data, ...payload}}))\r\n    .on(onlineUserMountFromIDB, (state, payload) => ({...state, data: {...state.data, ...payload}}))\r\n\r\n$onlineUser.watch((state) => {\r\n    if (Object.values(state.data).length > 0) {\r\n        idbSet('online_accounts', 'online_accounts', JSON.stringify(state.data))\r\n            .then(() => {\r\n            \r\n            })\r\n    }\r\n})\r\n\r\nexport const $userModel = combine({\r\n    $user,\r\n    $userSubsMe,\r\n    $userSubsMy,\r\n    $allUserList,\r\n    $onlineUser,\r\n    $recommendUsers\r\n})"]},"metadata":{},"sourceType":"module"}