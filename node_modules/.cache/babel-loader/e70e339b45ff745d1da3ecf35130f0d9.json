{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import axios from'axios';import Cookies from'js-cookie';import jwtDecode from'jwt-decode';import{tokenMount}from'../Models/app';import{showMessage}from'../UIComponents/MessageNotification';var isRefreshing=false;var refreshSubscribers=[];var devMode=null;var axiosHeaders=function axiosHeaders(){var _config$headers;var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};config.headers=(_config$headers=config.headers)!==null&&_config$headers!==void 0?_config$headers:{};if(devMode){config['headers']['dev-mode']=devMode;}return config;};var addSuffixToRequest=function addSuffixToRequest(config){if(!config.headers.hideSuffix){config.url=config.url.indexOf('/v1.0/api')===-1?\"/v1.0/api\".concat(config.url):config.url;}delete config.headers.hideSuffix;return config;};export var httpClient=axios.create({});function subscribeTokenRefresh(cb){refreshSubscribers.push(cb);}function onRefreshed(token){refreshSubscribers.map(function(cb){return cb(token);});refreshSubscribers=[];}httpClient.interceptors.response.use(function(response){return response;},function(error){var config=error.config,_error$response=error.response,status=_error$response.status,data=_error$response.data;var originalRequest=config;var refreshToken=Cookies.get('refresh-token');if(status===401){if(refreshToken){if(!isRefreshing){isRefreshing=true;axios.post(\"/v1.0/api/account/token-refresh/\",{refresh:refreshToken},_objectSpread({},axiosHeaders(config))).then(function(res){isRefreshing=false;onRefreshed(res.data.access);var tokens=Cookies.get('users')?JSON.parse(Cookies.get('users')):{};if(tokens){tokens[jwtDecode(res.data.access).username]={access:res.data.access,refresh:res.data.refresh};Cookies.set('users',JSON.stringify(tokens));}Cookies.set('token',res.data.access);tokenMount(res.data.access);Cookies.set('refresh-token',res.data.refresh);}).catch(function(){tokenMount(null);Cookies.remove('token');Cookies.remove('refresh-token');Cookies.remove('users');isRefreshing=false;});}return new Promise(function(resolve,reject){subscribeTokenRefresh(function(token){originalRequest.headers['Authorization']='Bearer '+token;resolve(axios(originalRequest));});});}}else if(status===400){var errorData=data.errors;for(var i=0;i<errorData.length;i++){showMessage(errorData[i].message,'danger');}}else{return Promise.reject(error);}});httpClient.interceptors.request.use(function(config){var token=Cookies.get('token');var configParams=axiosHeaders(config);configParams=addSuffixToRequest(configParams);if(window.innerWidth===1080){configParams.headers['x-device-id']='4';}else{configParams.headers['x-device-id']='3';}if(token){if(configParams.headers.notAuth===undefined){configParams.headers=Object.assign(configParams.headers,{Authorization:'Token '+token});}else{delete configParams.headers.notAuth;}return configParams;}else{delete configParams.headers['Authorization'];var lang=localStorage.getItem('lang')?JSON.parse(localStorage.getItem('lang')):'ru';if(lang){configParams.headers['lang']=lang;}return configParams;}});export var httpGet=function httpGet(params){return httpClient(_objectSpread({method:'get'},params));};export var httpPost=function httpPost(params){return httpClient(_objectSpread({method:'post'},params));};export var httpPut=function httpPut(params){return httpClient(_objectSpread({method:'put'},params));};export var httpPatch=function httpPatch(params){return httpClient(_objectSpread({method:'patch'},params));};export var httpDelete=function httpDelete(params){return httpClient(_objectSpread({method:'delete'},params));};","map":null,"metadata":{},"sourceType":"module"}