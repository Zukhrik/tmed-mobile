{"ast":null,"code":"import axios from 'axios';\nimport Cookies from 'js-cookie';\nimport jwtDecode from 'jwt-decode';\nimport { tokenMount } from '../Models/app';\nimport { showMessage } from '../UIComponents/MessageNotification';\nlet isRefreshing = false;\nlet refreshSubscribers = [];\nlet devMode = null;\n\nconst axiosHeaders = (config = {}) => {\n  var _config$headers;\n\n  config.headers = (_config$headers = config.headers) !== null && _config$headers !== void 0 ? _config$headers : {};\n\n  if (devMode) {\n    config['headers']['dev-mode'] = devMode;\n  }\n\n  return config;\n};\n\nexport const httpClientV2 = axios.create({});\n\nfunction subscribeTokenRefresh(cb) {\n  refreshSubscribers.push(cb);\n}\n\nfunction onRefreshed(token) {\n  refreshSubscribers.map(cb => cb(token));\n  refreshSubscribers = [];\n}\n\nhttpClientV2.interceptors.response.use(response => {\n  return response;\n}, error => {\n  const {\n    config,\n    response: {\n      status,\n      data\n    }\n  } = error;\n  const originalRequest = config;\n  const refreshToken = Cookies.get('refresh-token');\n\n  if (status === 401) {\n    if (refreshToken) {\n      if (!isRefreshing) {\n        isRefreshing = true;\n        axios.post(`/v1.0/api/account/token-refresh/`, {\n          refresh: refreshToken\n        }, { ...axiosHeaders(config)\n        }).then(res => {\n          isRefreshing = false;\n          onRefreshed(res.data.access);\n          const tokens = Cookies.get('users') ? JSON.parse(Cookies.get('users')) : {};\n\n          if (tokens) {\n            tokens[jwtDecode(res.data.access).username] = {\n              access: res.data.access,\n              refresh: res.data.refresh\n            };\n            Cookies.set('users', JSON.stringify(tokens));\n          }\n\n          Cookies.set('token', res.data.access);\n          tokenMount(res.data.access);\n          Cookies.set('refresh-token', res.data.refresh);\n        }).catch(() => {\n          tokenMount(null);\n          Cookies.remove('token');\n          Cookies.remove('refresh-token');\n          Cookies.remove('users');\n          isRefreshing = false;\n        });\n      }\n\n      return new Promise((resolve, reject) => {\n        subscribeTokenRefresh(token => {\n          originalRequest.headers['Authorization'] = 'Bearer ' + token;\n          resolve(axios(originalRequest));\n        });\n      });\n    }\n  } else if (status === 400) {\n    const errorData = data.errors;\n\n    for (let i = 0; i < errorData.length; i++) {\n      showMessage(errorData[i].message, 'danger');\n    }\n  } else {\n    return Promise.reject(error);\n  }\n});\nhttpClient.interceptors.request.use(config => {\n  let token = Cookies.get('token');\n  let configParams = axiosHeaders(config);\n  configParams.headers['x-device-id'] = '3';\n\n  if (token) {\n    if (configParams.headers.notAuth === undefined) {\n      configParams.headers = Object.assign(configParams.headers, {\n        Authorization: 'Token ' + token\n      });\n    } else {\n      delete configParams.headers.notAuth;\n    }\n\n    return configParams;\n  } else {\n    delete configParams.headers['Authorization'];\n    let lang = localStorage.getItem('lang') ? JSON.parse(localStorage.getItem('lang')) : 'ru';\n\n    if (lang) {\n      configParams.headers['lang'] = lang;\n    }\n\n    return configParams;\n  }\n});\nexport const httpGetV2 = params => httpClientV2({\n  method: 'get',\n  ...params\n});\nexport const httpPostV2 = params => httpClientV2({\n  method: 'post',\n  ...params\n});\nexport const httpPutV2 = params => httpClientV2({\n  method: 'put',\n  ...params\n});\nexport const httpPatchV2 = params => httpClientV2({\n  method: 'patch',\n  ...params\n});\nexport const httpDeleteV2 = params => httpClientV2({\n  method: 'delete',\n  ...params\n});","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Service-v2/index.js"],"names":["axios","Cookies","jwtDecode","tokenMount","showMessage","isRefreshing","refreshSubscribers","devMode","axiosHeaders","config","headers","httpClientV2","create","subscribeTokenRefresh","cb","push","onRefreshed","token","map","interceptors","response","use","error","status","data","originalRequest","refreshToken","get","post","refresh","then","res","access","tokens","JSON","parse","username","set","stringify","catch","remove","Promise","resolve","reject","errorData","errors","i","length","message","httpClient","request","configParams","notAuth","undefined","Object","assign","Authorization","lang","localStorage","getItem","httpGetV2","params","method","httpPostV2","httpPutV2","httpPatchV2","httpDeleteV2"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport Cookies from 'js-cookie'\nimport jwtDecode from 'jwt-decode'\nimport {tokenMount} from '../Models/app'\nimport {showMessage} from '../UIComponents/MessageNotification'\n\nlet isRefreshing = false\nlet refreshSubscribers = []\nlet devMode = null\n\nconst axiosHeaders = (config = {}) => {\n    config.headers = config.headers ?? {}\n    if (devMode) {\n        config['headers']['dev-mode'] = devMode\n    }\n    return config\n}\n\nexport const httpClientV2 = axios.create({})\n\nfunction subscribeTokenRefresh(cb) {\n    refreshSubscribers.push(cb)\n}\n\nfunction onRefreshed(token) {\n    refreshSubscribers.map(cb => cb(token))\n    refreshSubscribers = []\n}\n\nhttpClientV2.interceptors.response.use(response => {\n    return response\n}, error => {\n    const {config, response: {status, data}} = error\n    const originalRequest = config\n    const refreshToken = Cookies.get('refresh-token')\n    if (status === 401) {\n        if (refreshToken) {\n            if (!isRefreshing) {\n                isRefreshing = true\n                axios.post(`/v1.0/api/account/token-refresh/`, {refresh: refreshToken}, {...axiosHeaders(config)})\n                    .then(res => {\n                        isRefreshing = false\n                        onRefreshed(res.data.access)\n                        const tokens = Cookies.get('users') ? JSON.parse(Cookies.get('users')) : {}\n                        if (tokens) {\n                            tokens[jwtDecode(res.data.access).username] = {\n                                access: res.data.access,\n                                refresh: res.data.refresh\n                            }\n                            \n                            Cookies.set('users', JSON.stringify(tokens))\n                        }\n                        Cookies.set('token', res.data.access)\n                        tokenMount(res.data.access)\n                        Cookies.set('refresh-token', res.data.refresh)\n                    })\n                    .catch(() => {\n                        tokenMount(null)\n                        Cookies.remove('token')\n                        Cookies.remove('refresh-token')\n                        Cookies.remove('users')\n                        isRefreshing = false\n                    })\n            }\n            \n            return new Promise((resolve, reject) => {\n                subscribeTokenRefresh(token => {\n                    originalRequest.headers['Authorization'] = 'Bearer ' + token\n                    resolve(axios(originalRequest))\n                })\n            })\n        }\n    } else if (status === 400) {\n        const errorData = data.errors\n        for (let i = 0; i < errorData.length; i++) {\n            showMessage(errorData[i].message, 'danger')\n        }\n        \n    } else {\n        return Promise.reject(error)\n    }\n})\n\nhttpClient.interceptors.request.use(config => {\n    let token = Cookies.get('token')\n    let configParams = axiosHeaders(config)\n    configParams.headers['x-device-id'] = '3'\n    if (token) {\n        if (configParams.headers.notAuth === undefined) {\n            configParams.headers = Object.assign(configParams.headers, {Authorization: 'Token ' + token})\n        } else {\n            delete configParams.headers.notAuth\n        }\n        return configParams\n    } else {\n        delete configParams.headers['Authorization']\n        let lang = localStorage.getItem('lang') ? JSON.parse(localStorage.getItem('lang')) : 'ru'\n        if (lang) {\n            configParams.headers['lang'] = lang\n        }\n        return configParams\n    }\n})\n\nexport const httpGetV2 = params =>\n    httpClientV2({\n        method: 'get',\n        ...params\n    })\n\nexport const httpPostV2 = params =>\n    httpClientV2({\n        method: 'post',\n        ...params\n    })\n\nexport const httpPutV2 = params =>\n    httpClientV2({\n        method: 'put',\n        ...params\n    })\n\nexport const httpPatchV2 = params =>\n    httpClientV2({\n        method: 'patch',\n        ...params\n    })\n\nexport const httpDeleteV2 = params =>\n    httpClientV2({\n        method: 'delete',\n        ...params\n    })"]},"metadata":{},"sourceType":"module"}