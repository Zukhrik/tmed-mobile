{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{combine,createStore}from'effector';import{fetchAllUsers,fetchRecommendUsers,fetchSubscribeToUser,fetchUnsubscribeFromUser,fetchUser,fetchUserSubsMe,fetchUserSubsMy}from'./effects';import{idbSet}from'../../Config/db';import{onlineUserMount,onlineUserMountFromIDB,subscribeToRecommendUserMount,unsubscribeFromFallsMount}from'./events';import{changeSingleItemInArray,commonStoreList,storeWithKey}from'../../utils/store-utils';var $allUserList=createStore({loading:false,data:[],result:{},forceLoading:0,error:false}).on(fetchAllUsers.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAllUsers.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAllUsers.done,function(state,_ref2){var result=_ref2.result,params=_ref2.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(fetchSubscribeToUser.done,function(state,_ref3){var params=_ref3.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me+1,subscribed:true}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(fetchUnsubscribeFromUser.done,function(state,_ref4){var params=_ref4.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me-1,subscribed:false}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});});var $user=createStore({loading:false,data:{},error:{},forceLoading:0}).on(fetchUser.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUser.fail,function(state,_ref5){var error=_ref5.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUser.done,function(state,_ref6){var result=_ref6.result,key=_ref6.params,clear=_ref6.clear;var processed=storeWithKey({response:result.data,state:state,key:key,clear:clear});return _objectSpread(_objectSpread({},processed),{},{forceLoading:2});}).on(fetchSubscribeToUser.done,function(state,_ref7){var _ref7$params=_ref7.params,username=_ref7$params.username,action=_ref7$params.action;var data=_objectSpread({},state.data);if(username&&data[username]){data[username]=_objectSpread(_objectSpread({},data[username]),{},{subs:_objectSpread(_objectSpread({},data[username].subs),{},{subscribed:true})});if(action){action();}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchUnsubscribeFromUser.done,function(state,_ref8){var _ref8$params=_ref8.params,username=_ref8$params.username,action=_ref8$params.action;var data=_objectSpread({},state.data);if(username&&data[username]){data[username]=_objectSpread(_objectSpread({},data[username]),{},{subs:_objectSpread(_objectSpread({},data[username].subs),{},{subscribed:false})});if(action){action();}}return _objectSpread(_objectSpread({},state),{},{data:data});});var $userSubsMe=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchUserSubsMe.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUserSubsMe.fail,function(state,_ref9){var error=_ref9.error;return _objectSpread(_objectSpread({},state),{},{error:error,result:{},data:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUserSubsMe.done,function(state,_ref10){var result=_ref10.result,params=_ref10.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});});var $userSubsMy=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchUserSubsMy.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchUserSubsMy.fail,function(state,_ref11){var error=_ref11.error;return _objectSpread(_objectSpread({},state),{},{error:error,result:{},data:[],forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchUserSubsMy.done,function(state,_ref12){var result=_ref12.result,params=_ref12.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(unsubscribeFromFallsMount,function(state,_ref13){var username=_ref13.username;var data=_toConsumableArray(state.data);var idx=data.findIndex(function(item){return!item.to_org?item.to_user.username===username:item.to_org.slug_name===username;});if(idx!==-1){data=[].concat(_toConsumableArray(data.slice(0,idx)),_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});});var $recommendUsers=createStore({loading:false,data:[],result:{},error:false,forceLoading:0}).on(fetchRecommendUsers.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchRecommendUsers.fail,function(state,_ref14){var error=_ref14.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchRecommendUsers.done,function(state,_ref15){var result=_ref15.result,params=_ref15.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear,key:params.username},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(subscribeToRecommendUserMount,function(state,_ref16){var username=_ref16.username;var idx=state.data.findIndex(function(item){return item.username===username;});if(idx!==-1){// data = [...data.slice(0, idx), {\n//     ...data[idx].subs, subscribed: true\n// }, ...data.slice(idx + 1)]\n}return _objectSpread({},state);}).on(fetchSubscribeToUser.done,function(state,_ref17){var params=_ref17.params;var getOldData=function getOldData(oldData){return{subs:{me:oldData.subs.me+1,subscribed:true}};};var newData=changeSingleItemInArray({arr:state.data,key:'username',value:params.username,getOldData:getOldData});if(params.option){params.option();}return _objectSpread(_objectSpread({},state),{},{data:newData});});var $onlineUser=createStore({data:{}}).on(onlineUserMount,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:_objectSpread(_objectSpread({},state.data),payload)});}).on(onlineUserMountFromIDB,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:_objectSpread(_objectSpread({},state.data),payload)});});$onlineUser.watch(function(state){if(Object.values(state.data).length>0){idbSet('online_accounts','online_accounts',JSON.stringify(state.data)).then(function(){});}});export var $userModel=combine({$user:$user,$userSubsMe:$userSubsMe,$userSubsMy:$userSubsMy,$allUserList:$allUserList,$onlineUser:$onlineUser,$recommendUsers:$recommendUsers});","map":null,"metadata":{},"sourceType":"module"}