{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import moment from'moment';import order from'../../Service/order';import{getWeekDay}from'../../utils/time-utils';import{useCallback,useEffect,useState}from'react';export var formatter='YYYY-MM-DD HH:mm:ss';export var strHourToInt=function strHourToInt(strHour){return parseInt(strHour.split(':')[0]);};var getDateTime=function getDateTime(number){var now=new Date().toDateString();var time=String(number.toFixed(2)).split('.').join(':');return new Date(\"\".concat(now,\" \").concat(time));};export function useSpecialistDate(_ref){var job=_ref.job,dateData=_ref.dateData,active=_ref.active,handleChange=_ref.handleChange;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(getWeekDay(new Date())),_useState4=_slicedToArray(_useState3,2),currentWeekday=_useState4[0],setCurrentWeekday=_useState4[1];var _useState5=useState(new Date()),_useState6=_slicedToArray(_useState5,2),date=_useState6[0],setDate=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),hours=_useState8[0],setHours=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),meetTimes=_useState10[0],setMeetTimes=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),requestData=_useState12[0],setRequestData=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),isCurrentDate=_useState14[0],setIsCurrentDate=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),requestLoading=_useState16[0],setRequestLoading=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),mounted=_useState18[0],setMounted=_useState18[1];var generateData=useCallback(function(data){var tmp={};for(var i=0;i<data.length;i++){var id=moment(data[i].meet_date).format(formatter);var meetTime=moment(data[i].meet_date).format('HH.mm');tmp[id]={id:data[i].id,user:data[i].user,meetTime:parseFloat(meetTime).toFixed(1),meetTimeStr:moment(data[i].meet_date).format('HH:mm')};}return tmp;},[]);var addClientData=useCallback(function(order){if(dateData&&dateData.id){var meetTime=moment(dateData.id).format('HH.mm');order[dateData.id]={id:active.id,user:active.user,meetTime:parseFloat(meetTime).toFixed(1),meetTimeStr:moment(dateData.id).format('HH:mm')};return order;}return false;},[active,dateData]);var renderMeetRow=useCallback(function(id){var strHour=moment(id).format('HH:mm');var hourInt=strHourToInt(strHour);return meetTimes[hourInt]&&Object.values(meetTimes[hourInt]).sort(function(a,b){return a-b;});},[meetTimes]);var getOrgOrder=useCallback(function(params){setRequestLoading(true);order.getOrgOrderResponsible(params).then(function(res){var data=res.data.results;var orders=generateData(data);var withClientOrder=addClientData(orders);if(withClientOrder){orders=withClientOrder;}setRequestData(orders);}).finally(function(){return setRequestLoading(false);}).catch(function(){setRequestLoading(false);});},[generateData,addClientData]);useEffect(function(){if(job&&job.operating_mode&&job.operating_mode[currentWeekday]){var data=job.operating_mode[currentWeekday];var breaks=data.breaks;var to=parseInt(data.to);var interval=data.proc_interval;var tmp=[];var possibleMeetTime={};var from=parseInt(data.from);var a=data.from;while(a<to){for(var i=0;i<breaks.length;i++){if(parseInt(a)===parseInt(breaks[i].from)&&(breaks[i].from>=a||a<breaks[i].to)){a=breaks[i].to;}}possibleMeetTime[parseInt(a)]=possibleMeetTime[parseInt(a)]?_objectSpread({},possibleMeetTime[parseInt(a)]):{};var strHour=moment(new Date(new Date(getDateTime(a)).setMinutes(new Date(getDateTime(a===from?data.from:a)).getMinutes()+interval)));var id=moment(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).format(formatter);possibleMeetTime[parseInt(a)][id]={intDate:a,isPossible:isCurrentDate,strDate:\"\".concat(moment(getDateTime(a)).format('HH:mm'),\" - \").concat(strHour.format('HH:mm')),dateString:moment(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(a)).format('HH:mm')))).format(formatter)};a=parseFloat(strHour.format('HH.mm'));}setMeetTimes(possibleMeetTime);if(isCurrentDate){from=moment(new Date()).format('H');}for(var _i=from;_i<to;_i++){var _id=moment(new Date(\"\".concat(date.toDateString(),\" 0\").concat(_i,\":00\"))).format(formatter);if(_i<10){tmp.push({hour:\"0\".concat(_i,\":00\"),interval:data.proc_interval,id:_id});}else{tmp.push({hour:\"\".concat(_i,\":00\"),interval:data.proc_interval,id:_id});}}setHours(tmp);setError(null);}else{setError('Не рабочий день');}},[job,currentWeekday,date,isCurrentDate]);var getOrders=useCallback(function(id){var data={responsible_id:id,params:{limit:200,offset:0,meet_date__gt:moment(new Date(\"\".concat(date.toDateString(),\" 00:00\"))).format(formatter),meet_date__lt:moment(new Date(\"\".concat(date.toDateString(),\" 23:59\"))).format(formatter)}};getOrgOrder(data);},[date,getOrgOrder]);var changeClientDate=useCallback(function(meet_date,meetTime){var orders=_objectSpread({},requestData);var params={id:active.id,user:active.user,meetTime:parseFloat(meetTime).toFixed(1),meetTimeStr:moment(meet_date).format('HH:mm')};if(dateData&&dateData.id&&orders[dateData.id]){delete orders[dateData.id];}var clientDate={date:meet_date,id:meet_date};handleChange(clientDate);orders[meet_date]=params;setRequestData(orders);},[active,dateData,requestData,handleChange]);var onChange=useCallback(function(meetDate){var meet_date=moment(new Date(\"\".concat(date.toDateString(),\" \").concat(moment(getDateTime(meetDate)).format('HH:mm')))).format(formatter);var meetTime=moment(meet_date).format('HH.mm');changeClientDate(meet_date,meetTime);},[changeClientDate,date]);var selectDate=useCallback(function(date){setDate(new Date(date));setCurrentWeekday(getWeekDay(new Date(date)));if(moment(date).format('YYYY-MM-DD')===moment(new Date()).format('YYYY-MM-DD')){setIsCurrentDate(true);}else{setIsCurrentDate(false);}},[]);useEffect(function(){if(!mounted&&job){getOrders(job.id);setMounted(true);}},[getOrders,mounted,job]);return{hours:hours,renderMeetRow:renderMeetRow,requestData:requestData,onChange:onChange,selectDate:selectDate,date:date,requestLoading:requestLoading,error:error};}","map":null,"metadata":{},"sourceType":"module"}