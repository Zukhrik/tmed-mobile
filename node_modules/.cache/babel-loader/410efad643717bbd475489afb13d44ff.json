{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _excluded=[\"checkbox\",\"confirmPassword\"];import*as Yup from'yup';import{useFormik}from'formik';import debounce from'lodash.debounce';import account from'../../Service/account';import{useTranslation}from'react-i18next';import{slugify}from'../../utils/stringUtils';import{URL_KEYS,URL_VALUES}from'../../Constants';import{useCallback,useEffect,useState}from'react';import{useHistory,useLocation}from'react-router-dom';var errors_by_field={phone:'',username:'',password:''};var values={name:'',phone:'',lastname:'',username:'',password:'',checkbox:false,confirmPassword:''};export function useCreateAccount(){var _useHistory=useHistory(),push=_useHistory.push;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useLocation=useLocation(),state=_useLocation.state;var _useState=useState(values),_useState2=_slicedToArray(_useState,2),initialValues=_useState2[0],setInitialValues=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),usernameStatus=_useState4[0],setUsernameStatus=_useState4[1];var _useState5=useState(errors_by_field),_useState6=_slicedToArray(_useState5,2),fetchedErrors=_useState6[0],setFetchedError=_useState6[1];var validationSchema=Yup.object().shape({name:Yup.string().required(t('required_field')),lastname:Yup.string().required(t('required_field')),username:Yup.string().required(t('required_field')).test('usernameValidation',t(fetchedErrors.username),function(){return fetchedErrors.username.length===0;}),phone:Yup.string().required(t('required_field')).test('phoneError',t(fetchedErrors.phone),function(){return fetchedErrors['phone'].length===0;}),password:Yup.string().min(8,t('at_least_eight_symbols')).required(t('required_field')).test('passwordError',t(fetchedErrors.password),function(){return fetchedErrors['password'].length===0;}),confirmPassword:Yup.string().oneOf([Yup.ref('password'),null],t('password_mismatch')).required(t('required_field'))});var formik=useFormik({initialValues:initialValues,validationSchema:validationSchema,enableReinitialize:true,onSubmit:function onSubmit(values,_ref){var setSubmitting=_ref.setSubmitting;setSubmitting(true);var checkbox=values.checkbox,confirmPassword=values.confirmPassword,data=_objectWithoutProperties(values,_excluded);push({pathname:'/sign-up',search:\"\".concat(URL_KEYS.STEP,\"=\").concat(URL_VALUES.PHONE_VERIFY),state:formik.values});account.createAccount(_objectSpread(_objectSpread({},data),{},{phone:\"+\".concat(data.phone)})).then(function(){push({pathname:'/sign-up',search:\"\".concat(URL_KEYS.STEP,\"=\").concat(URL_VALUES.PHONE_VERIFY),state:formik.values});}).catch(function(error){var errorData=error.response.data.errors||[];var touched={};var data={};if(errorData){for(var i=0;i<errorData.length;i++){touched[errorData[i].field]=true;data[errorData[i].field]=errorData[i].message.replace(/[[\\]']+/g,'');}formik.setTouched(_objectSpread({},touched));formik.setErrors(_objectSpread({},data));setFetchedError(_objectSpread(_objectSpread({},errors_by_field),data));}}).finally(function(){return setSubmitting(false);});}});var validateUsername=function validateUsername(data){var value=data.toLowerCase();formik.setFieldValue('username',slugify(value.toLowerCase()));var touched=formik.touched;var errors=formik.errors;if(value.trim().length>2){account.validateUsername({username:slugify(value.toLowerCase())}).then(function(res){if(res.data.status){setUsernameStatus(1);setFetchedError(errors_by_field);delete touched['username'];delete errors['username'];formik.setErrors(errors);formik.setTouched(touched);}else{formik.setTouched(_objectSpread(_objectSpread({},touched),{},{username:true}));formik.setErrors(_objectSpread(_objectSpread({},errors),{},{username:res.data.error.message}));setUsernameStatus(0);setFetchedError(_objectSpread(_objectSpread({},errors_by_field),{},{username:res.data.error.message}));}});}else{setUsernameStatus(-1);}};var disabledButton=useCallback(function(){return formik.isSubmitting||formik.values.name.trim().length===0||formik.values.lastname.trim().length===0||formik.values.username.trim().length===0||formik.touched.username&&!!formik.errors.username||formik.values.phone.trim().length===0||formik.values.password.trim().length===0||formik.values.confirmPassword.trim().length===0||formik.touched.confirmPassword&&!!formik.errors.confirmPassword||!formik.values.checkbox||fetchedErrors['phone'].length>0;},[formik,fetchedErrors]);var handleUsernameChange=debounce(validateUsername,50);var handleChange=function handleChange(key,value){setFetchedError(errors_by_field);formik.setFieldValue(key,value);};useEffect(function(){if(state){setInitialValues(state);}},[state]);return{formik:formik,handleChange:handleChange,usernameStatus:usernameStatus,disabledButton:disabledButton,handleUsernameChange:handleUsernameChange};}","map":null,"metadata":{},"sourceType":"module"}