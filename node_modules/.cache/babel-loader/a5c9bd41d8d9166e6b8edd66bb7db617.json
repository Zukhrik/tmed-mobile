{"ast":null,"code":"import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import useWebSocket from'react-use-websocket';import{useEffect,useState}from'react';import{useStore}from'effector-react';import{$appModel,socketCountersMount}from'../../Models/app';import{addedMessageToListFromSocket,addedMessageFromSocket}from'../../Models/chat-model';import{useLocation}from'react-router-dom';export function useChatWs(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),chatsUrl=_useState2[0],setChatsUrl=_useState2[1];var _useStore=useStore($appModel),token=_useStore.$app.token;var _useLocation=useLocation(),pathname=_useLocation.pathname;var getAddedMessageToListFromSocket=function getAddedMessageToListFromSocket(data){var objectData=data.object;var payload={is_muted:objectData.is_muted,last_message:{date:objectData.date,file:objectData.file,sender:objectData.sender,text:objectData.text},receiver:objectData.sender,receiver_type:'user',unread_count:data.counters.unread_count};addedMessageToListFromSocket({type:'user',payload:payload,key:objectData.sender.username});};var getAddedMessageToSingleChat=function getAddedMessageToSingleChat(data){addedMessageFromSocket({payload:data,key:data.sender.username});};useWebSocket(chatsUrl,{onMessage:function onMessage(e){var data=JSON.parse(e.data);if(data.counters&&data.counters.unread_count_all){socketCountersMount({chatUnreadCounter:data.counters.unread_count_all});}if(data.action==='add'&&data.object){var isSingle=pathname.match(/([^/]*)\\/[^/]*$/)[1]==='chat';getAddedMessageToListFromSocket(data);if(isSingle){getAddedMessageToSingleChat(data.object);}}},onError:function onError(e){// console.log(e)\n}});useEffect(function(){if(token){setChatsUrl(\"wss://py.dwed.biz/ws/v1.0/chats/?token=\".concat(token));}else{setChatsUrl(null);}},[token]);}","map":null,"metadata":{},"sourceType":"module"}