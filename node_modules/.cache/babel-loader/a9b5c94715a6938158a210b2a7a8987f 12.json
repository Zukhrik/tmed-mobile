{"ast":null,"code":"import moment from 'moment';\nimport { useUrlParams } from '../app';\nimport { useOrgPayments } from '../org';\nimport { useStore } from 'effector-react';\nimport order from '../../Service/order';\nimport { URL_KEYS } from '../../Constants';\nimport { useHistory } from 'react-router-dom';\nimport { formatter } from './use-specialist-date';\nimport { $orgModel } from '../../Models/org-model';\nimport { useCallback, useEffect, useState } from 'react';\nimport { resetOrderCartList, resetOrgOrderCart } from '../../Models/order-model';\nexport function useCheckout(couponId) {\n  useOrgPayments();\n  const {\n    $orgPaymentMethods: {\n      data\n    }\n  } = useStore($orgModel);\n  const [comment, setComment] = useState('');\n  const [activeDay, setActiveDay] = useState(moment(new Date()).format('YYYY-MM-DD'));\n  const [meetDate, setMeetDate] = useState(null);\n  const [payment, setPayment] = useState({\n    id: (data === null || data === void 0 ? void 0 : data.status) ? data === null || data === void 0 ? void 0 : data['1'].id : null,\n    title: (data === null || data === void 0 ? void 0 : data.status) ? data === null || data === void 0 ? void 0 : data['1'].method : null,\n    extraId: null\n  });\n  const {\n    urlData\n  } = useUrlParams();\n  const spec_id = urlData[URL_KEYS.SPECIALIST_ID];\n  const _activeDate = urlData[URL_KEYS.DATE];\n  const time = urlData[URL_KEYS.TIME];\n  const text = urlData[URL_KEYS.TEXT];\n  const {\n    push\n  } = useHistory();\n  const generateMeetTimeLink = useCallback(time => {\n    const url = [];\n\n    if (specId) {\n      url.push(`${URL_KEYS.SPECIALIST_ID}=${specId}`);\n    }\n\n    url.push(`${URL_KEYS.DATE}=${activeDay}`);\n    url.push(`${URL_KEYS.TIME}=${time}`);\n    return {\n      pathname,\n      search: url.join('&')\n    };\n  }, [activeDay, pathname, specId]);\n  const handleSubmit = useCallback(() => {\n    if (spec_id && meetDate) {\n      const data = {\n        meet_date: moment(new Date(meetDate)).format(formatter),\n        client_comment: comment && comment.trim().length > 0 ? comment : null,\n        responsible_id: spec_id,\n        payment: payment.extraId,\n        coupon_id: couponId,\n        card_id: Number(payment.extraId) === 3 ? payment.id : null\n      };\n      order.createOrder(data).then(res => {\n        if (res) {\n          push(`/records/detail/${res.data.id}`);\n          resetOrgOrderCart();\n          resetOrderCartList();\n        }\n      });\n    }\n  }, [spec_id, comment, meetDate, payment, push, couponId]);\n  useEffect(() => {\n    let timeout = null;\n    timeout = setTimeout(() => {\n      if (!!activeDay && !!time) {\n        setMeetDate(new Date(moment(`${activeDay} ${time}`).toDate()).getTime());\n      } else {\n        setMeetDate(null);\n      }\n    }, 100);\n    return () => {\n      clearTimeout(timeout);\n      timeout = null;\n    };\n  }, [time, activeDay]);\n  useEffect(() => {\n    let timeout = null;\n    timeout = setTimeout(() => {\n      if (_activeDate) {\n        setActiveDay(_activeDate);\n      } else {\n        setActiveDay(moment(new Date()).format('YYYY-MM-DD'));\n      }\n    }, 100);\n    return () => {\n      clearTimeout(timeout);\n      timeout = null;\n    };\n  }, [_activeDate]);\n  useEffect(() => {\n    if (!text) {\n      setComment(text);\n    }\n  }, [text]);\n  useEffect(() => {\n    let timeout = null;\n    timeout = setTimeout(() => {\n      if (!spec_id) {\n        push('/records/unregistered');\n      }\n    }, 600);\n    return () => {\n      clearTimeout(timeout);\n      timeout = null;\n    };\n  }, [spec_id, push]);\n  useEffect(() => {\n    if (procInterval) {\n      generateMeetTimeLink();\n    }\n  }, [procInterval, generateMeetTimeLink]);\n  return {\n    comment,\n    handleSubmit,\n    activeDay,\n    meetDate,\n    setComment,\n    payment,\n    setPayment\n  };\n}","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Hooks/checkout/use-checkout.js"],"names":["moment","useUrlParams","useOrgPayments","useStore","order","URL_KEYS","useHistory","formatter","$orgModel","useCallback","useEffect","useState","resetOrderCartList","resetOrgOrderCart","useCheckout","couponId","$orgPaymentMethods","data","comment","setComment","activeDay","setActiveDay","Date","format","meetDate","setMeetDate","payment","setPayment","id","status","title","method","extraId","urlData","spec_id","SPECIALIST_ID","_activeDate","DATE","time","TIME","text","TEXT","push","generateMeetTimeLink","url","specId","pathname","search","join","handleSubmit","meet_date","client_comment","trim","length","responsible_id","coupon_id","card_id","Number","createOrder","then","res","timeout","setTimeout","toDate","getTime","clearTimeout","procInterval"],"mappings":"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","sourcesContent":["import moment from 'moment'\nimport {useUrlParams} from '../app'\nimport {useOrgPayments} from '../org'\nimport {useStore} from 'effector-react'\nimport order from '../../Service/order'\nimport {URL_KEYS} from '../../Constants'\nimport {useHistory} from 'react-router-dom'\nimport {formatter} from './use-specialist-date'\nimport {$orgModel} from '../../Models/org-model'\nimport {useCallback, useEffect, useState} from 'react'\nimport {resetOrderCartList, resetOrgOrderCart} from '../../Models/order-model'\n\nexport function useCheckout(couponId) {\n    useOrgPayments()\n    const {$orgPaymentMethods: {data}} = useStore($orgModel)\n    const [comment, setComment] = useState('')\n    const [activeDay, setActiveDay] = useState(moment(new Date()).format('YYYY-MM-DD'))\n    const [meetDate, setMeetDate] = useState(null)\n    const [payment, setPayment] = useState({\n        id: data?.status ? data?.['1'].id : null,\n        title: data?.status ? data?.['1'].method : null,\n        extraId: null\n    })\n    const {urlData} = useUrlParams()\n    const spec_id = urlData[URL_KEYS.SPECIALIST_ID]\n    const _activeDate = urlData[URL_KEYS.DATE]\n    const time = urlData[URL_KEYS.TIME]\n    const text = urlData[URL_KEYS.TEXT]\n    const {push} = useHistory()\n    \n    const generateMeetTimeLink = useCallback((time) => {\n        const url = []\n        if (specId) {\n            url.push(`${URL_KEYS.SPECIALIST_ID}=${specId}`)\n        }\n        url.push(`${URL_KEYS.DATE}=${activeDay}`)\n        url.push(`${URL_KEYS.TIME}=${time}`)\n        return {\n            pathname,\n            search: url.join('&')\n        }\n    }, [activeDay, pathname, specId])\n    \n    const handleSubmit = useCallback(() => {\n        if (spec_id && meetDate) {\n            const data = {\n                meet_date: moment(new Date(meetDate)).format(formatter),\n                client_comment: comment && comment.trim().length > 0 ? comment : null,\n                responsible_id: spec_id,\n                payment: payment.extraId,\n                coupon_id: couponId,\n                card_id: Number(payment.extraId) === 3 ? payment.id : null\n            }\n            order.createOrder(data)\n                .then((res) => {\n                    if (res) {\n                        push(`/records/detail/${res.data.id}`)\n                        resetOrgOrderCart()\n                        resetOrderCartList()\n                    }\n                })\n        }\n        \n    }, [spec_id, comment, meetDate, payment, push, couponId])\n    \n    \n    useEffect(() => {\n        let timeout = null\n        \n        timeout = setTimeout(() => {\n            if (!!activeDay && !!time) {\n                setMeetDate(new Date(moment(`${activeDay} ${time}`).toDate()).getTime())\n            } else {\n                setMeetDate(null)\n            }\n        }, 100)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [time, activeDay])\n    \n    useEffect(() => {\n        let timeout = null\n        timeout = setTimeout(() => {\n            if (_activeDate) {\n                \n                setActiveDay(_activeDate)\n            } else {\n                setActiveDay(moment(new Date()).format('YYYY-MM-DD'))\n            }\n        }, 100)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [_activeDate])\n    \n    useEffect(() => {\n        if (!text) {\n            setComment(text)\n        }\n    }, [text])\n    \n    useEffect(() => {\n        let timeout = null\n        \n        timeout = setTimeout(() => {\n            if (!spec_id) {\n                push('/records/unregistered')\n            }\n        }, 600)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [spec_id, push])\n    \n    useEffect(() => {\n        if (procInterval) {\n            generateMeetTimeLink()\n        }\n    }, [procInterval, generateMeetTimeLink])\n    \n    \n    return {comment, handleSubmit, activeDay, meetDate, setComment, payment, setPayment}\n}"]},"metadata":{},"sourceType":"module"}