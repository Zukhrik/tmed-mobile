{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as Yup from'yup';import Cookies from'js-cookie';import{useFormik}from'formik';import jwtDecode from'jwt-decode';import auth from'../../Service/auth';import{useCallback,useState}from'react';import{tokenMount}from'../../Models/app';import{useTranslation}from'react-i18next';import{isValidPhoneNumber}from'libphonenumber-js';import{getCurrentAccount}from'../../Models/account-model';import{queryClient}from'../../App';var values={phone:null,activation_code:''};export function useFastAuth(_ref){var onClose=_ref.onClose,action=_ref.action;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState=useState(values),_useState2=_slicedToArray(_useState,1),initialValues=_useState2[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),nextStep=_useState4[0],setNextStep=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showResend=_useState6[0],setShowResend=_useState6[1];var _useState7=useState(Date.now()+1000*120),_useState8=_slicedToArray(_useState7,2),deadline=_useState8[0],setDeadline=_useState8[1];var validationSchema=Yup.object().shape({phone:Yup.mixed().test('phoneValidation',t('invalid_phone_number'),function(data){if(data){var value=data.value,countryCode=data.countryCode;return isValidPhoneNumber(value,countryCode);}return true;}).required(t('required_field'))});var formik=useFormik({initialValues:initialValues,validationSchema:validationSchema,onSubmit:function onSubmit(values,_ref2){var setSubmitting=_ref2.setSubmitting;setSubmitting(true);var data={phone:\"\".concat(values.phone.value)};if(nextStep&&values.activation_code){data.activation_code=values.activation_code.replace(/\\s/g,'');}auth.createFastAuth(data).then(function(res){if(res){if(res.data.phone){setNextStep(true);}if(res.data.access){var users={};if(Cookies.get('users')){var oldUsers=JSON.parse(Cookies.get('users'));users=_objectSpread({},oldUsers);}users[jwtDecode(res.data.access).username]=res.data;tokenMount(res.data.access);Cookies.set('users',JSON.stringify(users));Cookies.set('token',res.data.access);Cookies.set('refresh-token',res.data.refresh);getCurrentAccount();queryClient.clear();onClose();if(action){action();}}}}).catch(function(error){console.log(error);}).finally(function(){return setSubmitting(false);});}});var disabledButton=useCallback(function(){return formik.isSubmitting||formik.touched.phone&&!!formik.errors.phone;},[formik]);var handleChange=function handleChange(key,value){formik.setFieldValue(key,value);};var onFinish=function onFinish(){setShowResend(true);};var resend=useCallback(function(){auth.createFastAuth({phone:\"+\".concat(formik.values.phone.value)}).then(function(res){if(res){setDeadline(Date.now()+1000*120);setShowResend(false);}});},[formik]);var phone=formik.values.phone;return{formik:formik,handleChange:handleChange,disabledButton:disabledButton,nextStep:nextStep,deadline:deadline,showResend:showResend,onFinish:onFinish,phone:phone,resend:resend};}","map":null,"metadata":{},"sourceType":"module"}