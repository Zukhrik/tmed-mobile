{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import axios from'axios';import Cookies from'js-cookie';import jwtDecode from'jwt-decode';import{tokenMount}from'../Models/app';import{showMessage}from'../UIComponents/MessageNotification';var isRefreshing=false;var refreshSubscribers=[];var devMode=null;var axiosHeaders=function axiosHeaders(){var _config$headers;var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};config.headers=(_config$headers=config.headers)!==null&&_config$headers!==void 0?_config$headers:{};if(devMode){config['headers']['dev-mode']=devMode;}return config;};var addSuffixToRequest=function addSuffixToRequest(config){if(!config.headers.hideSuffix){config.url=config.url.indexOf('/v1.0/api')===-1?\"/v1.0/api\".concat(config.url):config.url;}delete config.headers.hideSuffix;return config;};export var httpClient=axios.create({});function subscribeTokenRefresh(cb){refreshSubscribers.push(cb);}function onRefreshed(token){refreshSubscribers.map(function(cb){return cb(token);});refreshSubscribers=[];}httpClient.interceptors.response.use(function(response){return response;},function(error){var config=error.config,_error$response=error.response,status=_error$response.status,data=_error$response.data;var originalRequest=config;var refreshToken=Cookies.get('refresh-token');if(status===401){if(refreshToken){if(!isRefreshing){isRefreshing=true;axios.post(\"/v1.0/api/account/token-refresh/\",{refresh:refreshToken},_objectSpread({},axiosHeaders(config))).then(function(res){isRefreshing=false;onRefreshed(res.data.access);var tokens=Cookies.get('users')?JSON.parse(Cookies.get('users')):{};if(tokens){tokens[jwtDecode(res.data.access).username]={access:res.data.access,refresh:res.data.refresh};Cookies.set('users',JSON.stringify(tokens));}Cookies.set('token',res.data.access);tokenMount(res.data.access);Cookies.set('refresh-token',res.data.refresh);}).catch(function(){tokenMount(null);Cookies.remove('token');Cookies.remove('refresh-token');Cookies.remove('users');isRefreshing=false;});}return new Promise(function(resolve,reject){subscribeTokenRefresh(function(token){originalRequest.headers['Authorization']='Bearer '+token;resolve(axios(originalRequest));});});}}else if(status===400){var errorData=data.errors;for(var i=0;i<errorData.length;i++){showMessage(errorData[i].message,'danger');}}else{return Promise.reject(error);}});httpClient.interceptors.request.use(function(config){var token=Cookies.get('token');var configParams=axiosHeaders(config);configParams=addSuffixToRequest(configParams);if(window.innerWidth===1080){configParams.headers['x-device-id']='4';}else{configParams.headers['x-device-id']='3';}if(token){if(configParams.headers.notAuth===undefined){configParams.headers=Object.assign(configParams.headers,{Authorization:'Token '+token});}else{delete configParams.headers.notAuth;}return configParams;}else{delete configParams.headers['Authorization'];var lang=localStorage.getItem('lang')?JSON.parse(localStorage.getItem('lang')):'ru';if(lang){configParams.headers['lang']=lang;}return configParams;}});export var httpGet=function httpGet(params){return httpClient(_objectSpread({method:'get'},params));};export var httpPost=function httpPost(params){return httpClient(_objectSpread({method:'post'},params));};export var httpPut=function httpPut(params){return httpClient(_objectSpread({method:'put'},params));};export var httpPatch=function httpPatch(params){return httpClient(_objectSpread({method:'patch'},params));};export var httpDelete=function httpDelete(params){return httpClient(_objectSpread({method:'delete'},params));};","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Service/index.js"],"names":["axios","Cookies","jwtDecode","tokenMount","showMessage","isRefreshing","refreshSubscribers","devMode","axiosHeaders","config","headers","addSuffixToRequest","hideSuffix","url","indexOf","httpClient","create","subscribeTokenRefresh","cb","push","onRefreshed","token","map","interceptors","response","use","error","status","data","originalRequest","refreshToken","get","post","refresh","then","res","access","tokens","JSON","parse","username","set","stringify","catch","remove","Promise","resolve","reject","errorData","errors","i","length","message","request","configParams","window","innerWidth","notAuth","undefined","Object","assign","Authorization","lang","localStorage","getItem","httpGet","params","method","httpPost","httpPut","httpPatch","httpDelete"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport Cookies from 'js-cookie'\nimport jwtDecode from 'jwt-decode'\nimport {tokenMount} from '../Models/app'\nimport {showMessage} from '../UIComponents/MessageNotification'\n\nlet isRefreshing = false\nlet refreshSubscribers = []\nlet devMode = null\n\nconst axiosHeaders = (config = {}) => {\n    config.headers = config.headers ?? {}\n    if (devMode) {\n        config['headers']['dev-mode'] = devMode\n    }\n    return config\n}\n\nconst addSuffixToRequest = (config) => {\n    if (!config.headers.hideSuffix) {\n        config.url = config.url.indexOf('/v1.0/api') === -1 ? `/v1.0/api${config.url}` : config.url\n    }\n    delete config.headers.hideSuffix\n    return config\n}\n\nexport const httpClient = axios.create({})\n\nfunction subscribeTokenRefresh(cb) {\n    refreshSubscribers.push(cb)\n}\n\nfunction onRefreshed(token) {\n    refreshSubscribers.map(cb => cb(token))\n    refreshSubscribers = []\n}\n\nhttpClient.interceptors.response.use(response => {\n    return response\n}, error => {\n    const {config, response: {status, data}} = error\n    const originalRequest = config\n    const refreshToken = Cookies.get('refresh-token')\n    if (status === 401) {\n        if (refreshToken) {\n            if (!isRefreshing) {\n                isRefreshing = true\n                axios.post(`/v1.0/api/account/token-refresh/`, {refresh: refreshToken}, {...axiosHeaders(config)})\n                    .then(res => {\n                        isRefreshing = false\n                        onRefreshed(res.data.access)\n                        const tokens = Cookies.get('users') ? JSON.parse(Cookies.get('users')) : {}\n                        if (tokens) {\n                            tokens[jwtDecode(res.data.access).username] = {\n                                access: res.data.access,\n                                refresh: res.data.refresh\n                            }\n                            \n                            Cookies.set('users', JSON.stringify(tokens))\n                        }\n                        Cookies.set('token', res.data.access)\n                        tokenMount(res.data.access)\n                        Cookies.set('refresh-token', res.data.refresh)\n                    })\n                    .catch(() => {\n                        tokenMount(null)\n                        Cookies.remove('token')\n                        Cookies.remove('refresh-token')\n                        Cookies.remove('users')\n                        isRefreshing = false\n                    })\n            }\n            \n            return new Promise((resolve, reject) => {\n                subscribeTokenRefresh(token => {\n                    originalRequest.headers['Authorization'] = 'Bearer ' + token\n                    resolve(axios(originalRequest))\n                })\n            })\n        }\n    } else if (status === 400) {\n        const errorData = data.errors\n        for (let i = 0; i < errorData.length; i++) {\n            showMessage(errorData[i].message, 'danger')\n        }\n        \n    } else {\n        return Promise.reject(error)\n    }\n})\n\nhttpClient.interceptors.request.use(config => {\n    let token = Cookies.get('token')\n    let configParams = axiosHeaders(config)\n    configParams = addSuffixToRequest(configParams)\n    if (window.innerWidth === 1080) {\n        configParams.headers['x-device-id'] = '4'\n    } else {\n        configParams.headers['x-device-id'] = '3'\n    }\n    \n    if (token) {\n        if (configParams.headers.notAuth === undefined) {\n            configParams.headers = Object.assign(configParams.headers, {Authorization: 'Token ' + token})\n        } else {\n            delete configParams.headers.notAuth\n        }\n        return configParams\n    } else {\n        delete configParams.headers['Authorization']\n        let lang = localStorage.getItem('lang') ? JSON.parse(localStorage.getItem('lang')) : 'ru'\n        if (lang) {\n            configParams.headers['lang'] = lang\n        }\n        return configParams\n    }\n})\n\nexport const httpGet = params =>\n    httpClient({\n        method: 'get',\n        ...params\n    })\n\nexport const httpPost = params =>\n    httpClient({\n        method: 'post',\n        ...params\n    })\n\nexport const httpPut = params =>\n    httpClient({\n        method: 'put',\n        ...params\n    })\n\nexport const httpPatch = params =>\n    httpClient({\n        method: 'patch',\n        ...params\n    })\n\nexport const httpDelete = params =>\n    httpClient({\n        method: 'delete',\n        ...params\n    })"]},"metadata":{},"sourceType":"module"}