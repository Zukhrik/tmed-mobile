{"ast":null,"code":"import{useCallback}from'react';import{useListQuery,useUrlParams}from'../app';import{useStore}from'effector-react';import order from'../../Service/order';import{useParams}from'react-router-dom';import{$appModel}from'../../Models/app';import{$accountModel}from'../../Models/account-model';import{getOrgOrderCartsMount}from'../../Models/order-model';import{useMutation}from'react-query';import{queryClient}from'../../App';import cart from'../../Service-v2/cart';export function useOrgOrder(){var _useListQuery=useListQuery(),query=_useListQuery.query;var _useParams=useParams(),organization=_useParams.organization;var _useStore=useStore($appModel),$detectLocationInfo=_useStore.$detectLocationInfo;var _useUrlParams=useUrlParams(),specId=_useUrlParams.urlData.specialist_id;var _useStore2=useStore($accountModel),currentProfile=_useStore2.$profiles.currentProfile;var currency=currentProfile?currentProfile.currency.code:$detectLocationInfo.currency||'';var create=useMutation(cart.addToCart,{onMutate:function onMutate(itemInfo){queryClient.cancelQueries(['/org/offerings',organization]);var _queryClient$getQuery=queryClient.getQueryData(['/org/offerings',organization,query]),pages=_queryClient$getQuery.pages;queryClient.setQueryData(['/org/offerings',organization]);return function(){return queryClient.setQueryData(['/org/offerings',organization],pages);};},onSuccess:function onSuccess(){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});},onError:function onError(err,itemId,rollback){return rollback();},onSettled:function onSettled(itemInfo){queryClient.invalidateQueries(['/org/offerings',organization]);}});var remove=useMutation(order.deleteOrderCart,{onMutate:function onMutate(itemInfo){queryClient.cancelQueries(['/org/offerings',organization]);var previousTodo=queryClient.getQueryData(['/org/offerings',organization,query]);queryClient.setQueryData(['/org/offerings',organization]);return function(){return queryClient.setQueryData(['/org/offerings',organization,query],previousTodo);};},onSuccess:function onSuccess(){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});},onError:function onError(err,newData,rollback){return rollback();},onSettled:function onSettled(itemInfo){queryClient.invalidateQueries(['/org/offerings',organization,query]).then(function(res){if(res){getOrgOrderCartsMount({org_slug_name:organization,params:{limit:1,offset:0},clear:true});}});}});var onCreatingCartItem=useCallback(function(event){var orgSpecList=event.responsible;if(event.inCart){remove.mutate({offering_id:event.id});}else{var data=[{offering_id:event.id,responsible_id:specId?specId:orgSpecList[0].id,qty:event.qty?event.qty:1}];create.mutate(data);}},[create,specId,remove]);var getIsLoading=useCallback(function(id){var _create$variables,_create$variables$dat,_remove$variables;if(create.isLoading&&(create===null||create===void 0?void 0:(_create$variables=create.variables)===null||_create$variables===void 0?void 0:(_create$variables$dat=_create$variables.data)===null||_create$variables$dat===void 0?void 0:_create$variables$dat.offering_id)===id){return true;}if(remove.isLoading&&(remove===null||remove===void 0?void 0:(_remove$variables=remove.variables)===null||_remove$variables===void 0?void 0:_remove$variables.offering_id)===id){return true;}return false;},[create,remove]);return{currency:currency,create:create,remove:remove,getIsLoading:getIsLoading,onCreatingCartItem:onCreatingCartItem};}","map":null,"metadata":{},"sourceType":"module"}