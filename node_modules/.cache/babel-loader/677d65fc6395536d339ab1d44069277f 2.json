{"ast":null,"code":"import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import moment from'moment';import{useUrlParams}from'../app';import{useOrgPayments}from'../org';import{useStore}from'effector-react';import order from'../../Service/order';import{URL_KEYS}from'../../Constants';import{useHistory}from'react-router-dom';import{formatter}from'./use-specialist-date';import{$orgModel}from'../../Models/org-model';import{useCallback,useEffect,useState}from'react';import{resetOrderCartList,resetOrgOrderCart}from'../../Models/order-model';export function useCheckout(){useOrgPayments();var _useStore=useStore($orgModel),data=_useStore.$orgPaymentMethods.data;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),comment=_useState2[0],setComment=_useState2[1];var _useState3=useState(moment(new Date()).format('YYYY-MM-DD')),_useState4=_slicedToArray(_useState3,2),activeDay=_useState4[0],setActiveDay=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),meetDate=_useState6[0],setMeetDate=_useState6[1];var _useState7=useState({id:(data===null||data===void 0?void 0:data.status)?data===null||data===void 0?void 0:data['1'].id:null,title:(data===null||data===void 0?void 0:data.status)?data===null||data===void 0?void 0:data['1'].method:null,extraId:null}),_useState8=_slicedToArray(_useState7,2),payment=_useState8[0],setPayment=_useState8[1];var _useUrlParams=useUrlParams(),urlData=_useUrlParams.urlData;var spec_id=urlData[URL_KEYS.SPECIALIST_ID];var _activeDate=urlData[URL_KEYS.DATE];var time=urlData[URL_KEYS.TIME];var text=urlData[URL_KEYS.TEXT];var _useHistory=useHistory(),push=_useHistory.push;var handleSubmit=useCallback(function(){if(spec_id&&meetDate){var _data={meet_date:moment(new Date(meetDate)).format(formatter),client_comment:comment&&comment.trim().length>0?comment:null,responsible_id:spec_id,payment:payment.extraId,card_id:Number(payment.extraId)===3?payment.id:null};order.createOrder(_data).then(function(res){if(res){push(\"/records/detail/\".concat(res.data.id));resetOrgOrderCart();resetOrderCartList();}});}},[spec_id,comment,meetDate,payment,push]);useEffect(function(){var timeout=null;timeout=setTimeout(function(){if(!!activeDay&&!!time){setMeetDate(new Date(moment(\"\".concat(activeDay,\" \").concat(time)).toDate()).getTime());}else{setMeetDate(null);}},100);return function(){clearTimeout(timeout);timeout=null;};},[time,activeDay]);useEffect(function(){var timeout=null;timeout=setTimeout(function(){if(_activeDate){setActiveDay(_activeDate);}else{setActiveDay(moment(new Date()).format('YYYY-MM-DD'));}},100);return function(){clearTimeout(timeout);timeout=null;};},[_activeDate]);useEffect(function(){if(!text){setComment(text);}},[text]);useEffect(function(){var timeout=null;timeout=setTimeout(function(){if(!spec_id){push('/records/unregistered');}},600);return function(){clearTimeout(timeout);timeout=null;};},[spec_id,push]);return{comment:comment,handleSubmit:handleSubmit,activeDay:activeDay,meetDate:meetDate,setComment:setComment,payment:payment,setPayment:setPayment};}","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Hooks/checkout/use-checkout.js"],"names":["moment","useUrlParams","useOrgPayments","useStore","order","URL_KEYS","useHistory","formatter","$orgModel","useCallback","useEffect","useState","resetOrderCartList","resetOrgOrderCart","useCheckout","data","$orgPaymentMethods","comment","setComment","Date","format","activeDay","setActiveDay","meetDate","setMeetDate","id","status","title","method","extraId","payment","setPayment","urlData","spec_id","SPECIALIST_ID","_activeDate","DATE","time","TIME","text","TEXT","push","handleSubmit","meet_date","client_comment","trim","length","responsible_id","card_id","Number","createOrder","then","res","timeout","setTimeout","toDate","getTime","clearTimeout"],"mappings":"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","sourcesContent":["import moment from 'moment'\nimport {useUrlParams} from '../app'\nimport {useOrgPayments} from '../org'\nimport {useStore} from 'effector-react'\nimport order from '../../Service/order'\nimport {URL_KEYS} from '../../Constants'\nimport {useHistory} from 'react-router-dom'\nimport {formatter} from './use-specialist-date'\nimport {$orgModel} from '../../Models/org-model'\nimport {useCallback, useEffect, useState} from 'react'\nimport {resetOrderCartList, resetOrgOrderCart} from '../../Models/order-model'\n\nexport function useCheckout() {\n    useOrgPayments()\n    const {$orgPaymentMethods: {data}} = useStore($orgModel)\n    const [comment, setComment] = useState('')\n    const [activeDay, setActiveDay] = useState(moment(new Date()).format('YYYY-MM-DD'))\n    const [meetDate, setMeetDate] = useState(null)\n    const [payment, setPayment] = useState({\n        id: data?.status ? data?.['1'].id : null,\n        title: data?.status ? data?.['1'].method : null,\n        extraId: null\n    })\n    const {urlData} = useUrlParams()\n    const spec_id = urlData[URL_KEYS.SPECIALIST_ID]\n    const _activeDate = urlData[URL_KEYS.DATE]\n    const time = urlData[URL_KEYS.TIME]\n    const text = urlData[URL_KEYS.TEXT]\n    const {push} = useHistory()\n    \n    const handleSubmit = useCallback(() => {\n        if (spec_id && meetDate) {\n            const data = {\n                meet_date: moment(new Date(meetDate)).format(formatter),\n                client_comment: comment && comment.trim().length > 0 ? comment : null,\n                responsible_id: spec_id,\n                payment: payment.extraId,\n                card_id: Number(payment.extraId) === 3 ? payment.id : null\n            }\n            order.createOrder(data)\n                .then((res) => {\n                    if (res) {\n                        push(`/records/detail/${res.data.id}`)\n                        resetOrgOrderCart()\n                        resetOrderCartList()\n                    }\n                })\n        }\n        \n    }, [spec_id, comment, meetDate, payment, push])\n    \n    \n    useEffect(() => {\n        let timeout = null\n        \n        timeout = setTimeout(() => {\n            if (!!activeDay && !!time) {\n                setMeetDate(new Date(moment(`${activeDay} ${time}`).toDate()).getTime())\n            } else {\n                setMeetDate(null)\n            }\n        }, 100)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [time, activeDay])\n    \n    useEffect(() => {\n        let timeout = null\n        timeout = setTimeout(() => {\n            if (_activeDate) {\n                \n                setActiveDay(_activeDate)\n            } else {\n                setActiveDay(moment(new Date()).format('YYYY-MM-DD'))\n            }\n        }, 100)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [_activeDate])\n    \n    useEffect(() => {\n        if (!text) {\n            setComment(text)\n        }\n    }, [text])\n    \n    useEffect(() => {\n        let timeout = null\n        \n        timeout = setTimeout(() => {\n            if (!spec_id) {\n                push('/records/unregistered')\n            }\n        }, 600)\n        \n        return () => {\n            clearTimeout(timeout)\n            timeout = null\n        }\n    }, [spec_id, push])\n    \n    \n    return {comment, handleSubmit, activeDay, meetDate, setComment, payment, setPayment}\n}"]},"metadata":{},"sourceType":"module"}