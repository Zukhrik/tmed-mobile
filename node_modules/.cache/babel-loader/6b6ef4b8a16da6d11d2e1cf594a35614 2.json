{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{LISTS}from'../../Constants';import{useStore}from'effector-react';import{useCallback,useEffect,useState}from'react';import{$regionModel,userRegionMount}from'../../Models/region-model';import{$categoryModel,categoryForceLoading,userCatListMount}from'../../Models/category-model';var initialParams={parent:0,params:{limit:20,offset:0,show_empties:'1'}};export function useCategory(_ref){var listType=_ref.listType,onChange=_ref.onChange,onClose=_ref.onClose;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),breadcrumb=_useState2[0],setBreadcrumb=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selected=_useState4[0],setSelected=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),parent=_useState6[0],setParent=_useState6[1];var _useStore=useStore($categoryModel),$categoryList=_useStore.$categoryList,result=_useStore.$categoryList.result;var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),list=_useState8[0],setList=_useState8[1];var _useStore2=useStore($regionModel),$userRegion=_useStore2.$userRegion;var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),searchValue=_useState10[0],setSearchValue=_useState10[1];var getList=useCallback(function(params){if(listType===LISTS.USER_CATEGORY){userCatListMount(params);}if(listType===LISTS.REGION){userRegionMount(params);}},[listType]);var getChildren=useCallback(function(item){var parentId=item.slug?item.slug:item.id;var data=_objectSpread(_objectSpread({clear:true},initialParams),{},{parent:parentId});categoryForceLoading();setParent(String(parentId));setBreadcrumb([].concat(_toConsumableArray(breadcrumb),[_objectSpread({},item)]));getList(data);},[getList,breadcrumb]);var renderList=useCallback(function(){if(listType===LISTS.USER_CATEGORY){setList($categoryList);}if(listType===LISTS.REGION){setList($userRegion);}},[listType,$categoryList,$userRegion]);var loadMore=useCallback(function(){if(result===null||result===void 0?void 0:result.nextOffset){var data=_objectSpread(_objectSpread({},initialParams),{},{parent:parent,params:_objectSpread(_objectSpread({},initialParams.params),{},{offset:result===null||result===void 0?void 0:result.nextOffset})});getList(data);}},[getList,parent,result]);var onSelect=useCallback(function(item){if(selected&&selected.id===item.id){setSelected(null);}else{setSelected(item);}},[selected]);var handleAccept=useCallback(function(){onChange(selected);onClose();},[onChange,selected,onClose]);var handleSubmit=function handleSubmit(e){e.preventDefault();if(searchValue.trim().length>0){if(listType==='user_category'){var data=_objectSpread(_objectSpread({},initialParams),{},{clear:true,params:_objectSpread(_objectSpread({},initialParams.params),{},{search:searchValue})});userCatListMount(data);}if(listType==='region'){var _data=_objectSpread(_objectSpread({},initialParams),{},{clear:true,params:_objectSpread(_objectSpread({},initialParams.params),{},{search:searchValue})});userRegionMount(_data);}}};var handleClick=function handleClick(e,id){e.preventDefault();var data=_objectSpread(_objectSpread({},initialParams),{},{parent:id,clear:true});if(id===0){setBreadcrumb([]);}else{var idx=breadcrumb.findIndex(function(item){return item.id===id;});var newData=_toConsumableArray(breadcrumb.slice(0,idx+1));setBreadcrumb(newData);}categoryForceLoading();setParent(id);getList(data);};useEffect(function(){var timeout=null;timeout=setTimeout(function(){categoryForceLoading();var data=_objectSpread({clear:true},initialParams);setBreadcrumb([]);setParent(0);getList(data);},200);return function(){clearTimeout(timeout);timeout=null;};},[getList]);useEffect(function(){renderList();},[renderList]);return{list:list,parent:parent,loadMore:loadMore,onSelect:onSelect,selected:selected,breadcrumb:breadcrumb,getChildren:getChildren,searchValue:searchValue,handleClick:handleClick,handleSubmit:handleSubmit,handleAccept:handleAccept,setSearchValue:setSearchValue};}","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Hooks/category/use-category.js"],"names":["LISTS","useStore","useCallback","useEffect","useState","$regionModel","userRegionMount","$categoryModel","categoryForceLoading","userCatListMount","initialParams","parent","params","limit","offset","show_empties","useCategory","listType","onChange","onClose","breadcrumb","setBreadcrumb","selected","setSelected","setParent","$categoryList","result","list","setList","$userRegion","searchValue","setSearchValue","getList","USER_CATEGORY","REGION","getChildren","item","parentId","slug","id","data","clear","String","renderList","loadMore","nextOffset","onSelect","handleAccept","handleSubmit","e","preventDefault","trim","length","search","handleClick","idx","findIndex","newData","slice","timeout","setTimeout","clearTimeout"],"mappings":"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","sourcesContent":["import {LISTS} from '../../Constants'\r\nimport {useStore} from 'effector-react'\r\nimport {useCallback, useEffect, useState} from 'react'\r\nimport {$regionModel, userRegionMount} from '../../Models/region-model'\r\nimport {$categoryModel, categoryForceLoading, userCatListMount} from '../../Models/category-model'\r\n\r\nconst initialParams = {\r\n    parent: 0,\r\n    params: {\r\n        limit: 20,\r\n        offset: 0,\r\n        show_empties: '1'\r\n    }\r\n}\r\n\r\nexport function useCategory({listType, onChange, onClose}) {\r\n    const [breadcrumb, setBreadcrumb] = useState([])\r\n    const [selected, setSelected] = useState(null)\r\n    const [parent, setParent] = useState(0)\r\n    const {$categoryList, $categoryList: {result}} = useStore($categoryModel)\r\n    const [list, setList] = useState({})\r\n    const {$userRegion} = useStore($regionModel)\r\n    const [searchValue, setSearchValue] = useState('')\r\n    \r\n    const getList = useCallback((params) => {\r\n        if (listType === LISTS.USER_CATEGORY) {\r\n            userCatListMount(params)\r\n        }\r\n        \r\n        if (listType === LISTS.REGION) {\r\n            userRegionMount(params)\r\n        }\r\n        \r\n    }, [listType])\r\n    \r\n    const getChildren = useCallback((item) => {\r\n        const parentId = item.slug ? item.slug : item.id\r\n        const data = {\r\n            clear: true,\r\n            ...initialParams,\r\n            parent: parentId\r\n        }\r\n        \r\n        categoryForceLoading()\r\n        setParent(String(parentId))\r\n        setBreadcrumb([...breadcrumb, {...item}])\r\n        getList(data)\r\n    }, [getList, breadcrumb])\r\n    \r\n    const renderList = useCallback(() => {\r\n        if (listType === LISTS.USER_CATEGORY) {\r\n            setList($categoryList)\r\n        }\r\n        \r\n        if (listType === LISTS.REGION) {\r\n            setList($userRegion)\r\n        }\r\n        \r\n    }, [listType, $categoryList, $userRegion])\r\n    \r\n    const loadMore = useCallback(() => {\r\n        if (result?.nextOffset) {\r\n            const data = {\r\n                ...initialParams,\r\n                parent,\r\n                params: {\r\n                    ...initialParams.params,\r\n                    offset: result?.nextOffset\r\n                }\r\n            }\r\n            getList(data)\r\n        }\r\n        \r\n    }, [getList, parent, result])\r\n    \r\n    const onSelect = useCallback((item) => {\r\n        if (selected && selected.id === item.id) {\r\n            setSelected(null)\r\n        } else {\r\n            setSelected(item)\r\n        }\r\n    }, [selected])\r\n    \r\n    const handleAccept = useCallback(() => {\r\n        onChange(selected)\r\n        onClose()\r\n    }, [onChange, selected, onClose])\r\n    \r\n    const handleSubmit = (e) => {\r\n        e.preventDefault()\r\n        if (searchValue.trim().length > 0) {\r\n            if (listType === 'user_category') {\r\n                const data = {\r\n                    ...initialParams,\r\n                    clear: true,\r\n                    params: {\r\n                        ...initialParams.params,\r\n                        search: searchValue\r\n                    }\r\n                }\r\n                userCatListMount(data)\r\n            }\r\n            \r\n            if (listType === 'region') {\r\n                const data = {\r\n                    ...initialParams,\r\n                    clear: true,\r\n                    params: {\r\n                        ...initialParams.params,\r\n                        search: searchValue\r\n                    }\r\n                }\r\n                userRegionMount(data)\r\n            }\r\n        }\r\n    }\r\n    \r\n    const handleClick = (e, id) => {\r\n        e.preventDefault()\r\n        const data = {\r\n            ...initialParams,\r\n            parent: id,\r\n            clear: true\r\n        }\r\n        \r\n        if (id === 0) {\r\n            setBreadcrumb([])\r\n        } else {\r\n            const idx = breadcrumb.findIndex(item => item.id === id)\r\n            const newData = [...breadcrumb.slice(0, idx + 1)]\r\n            setBreadcrumb(newData)\r\n        }\r\n        categoryForceLoading()\r\n        setParent(id)\r\n        getList(data)\r\n    }\r\n    \r\n    useEffect(() => {\r\n        let timeout = null\r\n        \r\n        timeout = setTimeout(() => {\r\n            categoryForceLoading()\r\n            const data = {\r\n                clear: true,\r\n                ...initialParams\r\n            }\r\n            setBreadcrumb([])\r\n            setParent(0)\r\n            getList(data)\r\n        }, 200)\r\n        \r\n        return () => {\r\n            clearTimeout(timeout)\r\n            timeout = null\r\n        }\r\n    }, [getList])\r\n    \r\n    useEffect(() => {\r\n        renderList()\r\n    }, [renderList])\r\n    \r\n    \r\n    return {\r\n        list,\r\n        parent,\r\n        loadMore,\r\n        onSelect,\r\n        selected,\r\n        breadcrumb,\r\n        getChildren,\r\n        searchValue,\r\n        handleClick,\r\n        handleSubmit,\r\n        handleAccept,\r\n        setSearchValue\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}