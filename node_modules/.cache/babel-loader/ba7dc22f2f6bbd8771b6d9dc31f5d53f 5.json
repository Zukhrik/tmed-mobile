{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{combine,createStore}from'effector';import{fetchCommentReplyList,fetchCreateComment,fetchPost,fetchPostComments,fetchPostOfferings}from'./effects';import{storeListWithKey,storeWithKey}from'../../utils/store-utils';import{commentLikeMount,createCommentMount,deleteLikeMount,deletePostCommentMount}from'./events';import{tapeLikeMount,tapeRemoveLikesMount}from'../tape-model';var $postOfferings=createStore({loading:false,data:{},result:{},error:false}).on(fetchPostOfferings.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchPostOfferings.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{}});}).on(fetchPostOfferings.done,function(state,_ref2){var result=_ref2.result,params=_ref2.params;var processed=storeListWithKey(_objectSpread({response:result.data,key:params.post_id,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread({},state),processed);});var $getPost=createStore({loading:false,data:{},result:{},forceLoading:0,error:false}).on(fetchPost.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchPost.fail,function(state,_ref3){var error=_ref3.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchPost.done,function(state,_ref4){var params=_ref4.params,result=_ref4.result;var processed=storeWithKey(_objectSpread({response:result.data,key:params.post_id,state:state},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2,result:result});}).on(tapeRemoveLikesMount,function(state,_ref5){var post_id=_ref5.post_id;var data=_objectSpread({},state.data);if(data[post_id]){data[post_id]=_objectSpread(_objectSpread({},data[post_id]),{},{is_liked:false,likes_count:data[post_id].likes_count>0&&data[post_id].likes_count-1});}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(tapeLikeMount,function(state,_ref6){var post_id=_ref6.post_id;var data=_objectSpread({},state.data);if(data[post_id]){data[post_id]=_objectSpread(_objectSpread({},data[post_id]),{},{is_liked:true,likes_count:data[post_id].likes_count+1});}return _objectSpread(_objectSpread({},state),{},{data:data});});var $getPostComments=createStore({loading:false,data:{},forceLoading:0,result:{},error:false}).on(fetchPostComments.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchPostComments.fail,function(state,_ref7){var error=_ref7.error;return _objectSpread(_objectSpread({},state),{},{error:error,result:{},data:[],forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchPostComments.done,function(state,_ref8){var result=_ref8.result,params=_ref8.params;var processed=storeListWithKey(_objectSpread({response:result.data,key:params.post_id,clear:params.clear,state:state},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(createCommentMount,function(state,_ref9){var temp_data=_ref9.temp_data,post_id=_ref9.post_id;var data=_objectSpread({},state.data);if(data[post_id]){data[post_id]=[temp_data].concat(_toConsumableArray(data[post_id]));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchCreateComment.done,function(state,_ref10){var result=_ref10.result,params=_ref10.params;var data=_objectSpread({},state.data);var post_id=params.post_id,temp_data=params.temp_data;var idx=!!data[post_id]&&data[post_id].findIndex(function(item){return item.id===temp_data.id;});if(idx!==false&&idx!==-1){var item=result.data;data[post_id]=[].concat(_toConsumableArray(data[post_id].slice(0,idx)),[item],_toConsumableArray(data[post_id].slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(commentLikeMount,function(state,_ref11){var post_id=_ref11.post_id,comment_id=_ref11.comment_id;var data=_objectSpread({},state.data);var idx=data[post_id].findIndex(function(item){return item.id===comment_id;});if(idx!==-1&&idx!==false){var oldData=_objectSpread({},data[post_id][idx]);data[post_id]=[].concat(_toConsumableArray(data[post_id].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{is_liked:true,likes_count:oldData.likes_count+1})],_toConsumableArray(data[post_id].slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(deleteLikeMount,function(state,_ref12){var post_id=_ref12.post_id,comment_id=_ref12.comment_id;var data=_objectSpread({},state.data);var idx=data[post_id].findIndex(function(item){return item.id===comment_id;});if(idx!==false&&idx!==-1){var oldData=_objectSpread({},data[post_id][idx]);data[post_id]=[].concat(_toConsumableArray(data[post_id].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{is_liked:false,likes_count:oldData.likes_count-1})],_toConsumableArray(data[post_id].slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(deletePostCommentMount,function(state,_ref13){var post_id=_ref13.post_id,comment_id=_ref13.comment_id;var data=_objectSpread({},state.data);var idx=data[post_id].findIndex(function(item){return item.id===comment_id;});if(data[post_id]){if(idx!==-1&&idx!==false){data[post_id]=[].concat(_toConsumableArray(data[post_id].splice(0,idx)),_toConsumableArray(data[post_id].splice(idx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});});var $commentReplyList=createStore({loading:false,data:[],result:{},error:false}).on(fetchCommentReplyList.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchCommentReplyList.fail,function(state,_ref14){var error=_ref14.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},result:{}});}).on(fetchCommentReplyList.done,function(state,_ref15){var result=_ref15.result;return _objectSpread(_objectSpread({},state),{},{data:result.data.results,result:result.data});});export var $postModel=combine({$getPost:$getPost,$postOfferings:$postOfferings,$getPostComments:$getPostComments,$commentReplyList:$commentReplyList});","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Models/post-model/stores.js"],"names":["combine","createStore","fetchCommentReplyList","fetchCreateComment","fetchPost","fetchPostComments","fetchPostOfferings","storeListWithKey","storeWithKey","commentLikeMount","createCommentMount","deleteLikeMount","deletePostCommentMount","tapeLikeMount","tapeRemoveLikesMount","$postOfferings","loading","data","result","error","on","pending","state","fail","done","params","processed","response","key","post_id","clear","$getPost","forceLoading","is_liked","likes_count","$getPostComments","temp_data","idx","findIndex","item","id","slice","comment_id","oldData","splice","$commentReplyList","results","$postModel"],"mappings":"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","sourcesContent":["import {combine, createStore} from 'effector'\r\nimport {fetchCommentReplyList, fetchCreateComment, fetchPost, fetchPostComments, fetchPostOfferings} from './effects'\r\nimport {storeListWithKey, storeWithKey} from '../../utils/store-utils'\r\nimport {commentLikeMount, createCommentMount, deleteLikeMount, deletePostCommentMount} from './events'\r\nimport {tapeLikeMount, tapeRemoveLikesMount} from '../tape-model'\r\n\r\nconst $postOfferings = createStore({loading: false, data: {}, result: {}, error: false})\r\n    .on(fetchPostOfferings.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchPostOfferings.fail, (state, {error}) => ({\r\n        ...state, error, data: {}\r\n    }))\r\n    .on(fetchPostOfferings.done, (state, {result, params}) => {\r\n        const processed = storeListWithKey({\r\n            response: result.data, key: params.post_id, state, clear: params.clear, ...params.params\r\n        })\r\n        return {\r\n            ...state, ...processed\r\n        }\r\n    })\r\n\r\nconst $getPost = createStore({loading: false, data: {}, result: {}, forceLoading: 0, error: false})\r\n    .on(fetchPost.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchPost.fail, (state, {error}) => ({\r\n        ...state, error, data: {}, result: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchPost.done, (state, {params, result}) => {\r\n        const processed = storeWithKey({\r\n            response: result.data, key: params.post_id, state, ...params.params\r\n        })\r\n        return {...state, ...processed, forceLoading: 2, result: result}\r\n    })\r\n    .on(tapeRemoveLikesMount, (state, {post_id}) => {\r\n        const data = {...state.data}\r\n        if (data[post_id]) {\r\n            data[post_id] = {\r\n                ...data[post_id],\r\n                is_liked: false, likes_count: data[post_id].likes_count > 0 && data[post_id].likes_count - 1\r\n            }\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(tapeLikeMount, (state, {post_id}) => {\r\n        const data = {...state.data}\r\n        \r\n        if (data[post_id]) {\r\n            data[post_id] = {...data[post_id], is_liked: true, likes_count: data[post_id].likes_count + 1}\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n\r\n\r\nconst $getPostComments = createStore({loading: false, data: {}, forceLoading: 0, result: {}, error: false})\r\n    .on(fetchPostComments.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchPostComments.fail, (state, {error}) => ({\r\n        ...state, error, result: {}, data: [], forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchPostComments.done, (state, {result, params}) => {\r\n        const processed = storeListWithKey({\r\n            response: result.data, key: params.post_id, clear: params.clear, state, ...params.params\r\n        })\r\n        \r\n        return {...state, ...processed, forceLoading: 2}\r\n    })\r\n    .on(createCommentMount, (state, {temp_data, post_id}) => {\r\n        const data = {...state.data}\r\n        \r\n        if (data[post_id]) {\r\n            data[post_id] = [temp_data, ...data[post_id]]\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(fetchCreateComment.done, (state, {result, params}) => {\r\n        const data = {...state.data}\r\n        const {post_id, temp_data} = params\r\n        const idx = !!data[post_id] && data[post_id].findIndex(item => item.id === temp_data.id)\r\n        \r\n        if (idx !== false && idx !== -1) {\r\n            const item = result.data\r\n            data[post_id] = [...data[post_id].slice(0, idx), item, ...data[post_id].slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(commentLikeMount, (state, {post_id, comment_id}) => {\r\n        const data = {...state.data}\r\n        const idx = data[post_id].findIndex(item => item.id === comment_id)\r\n        \r\n        if (idx !== -1 && idx !== false) {\r\n            const oldData = {...data[post_id][idx]}\r\n            data[post_id] = [...data[post_id].slice(0, idx), {\r\n                ...oldData, is_liked: true, likes_count: oldData.likes_count + 1\r\n            }, ...data[post_id].slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(deleteLikeMount, (state, {post_id, comment_id}) => {\r\n        const data = {...state.data}\r\n        const idx = data[post_id].findIndex(item => item.id === comment_id)\r\n        \r\n        if (idx !== false && idx !== -1) {\r\n            const oldData = {...data[post_id][idx]}\r\n            data[post_id] = [...data[post_id].slice(0, idx), {\r\n                ...oldData, is_liked: false, likes_count: oldData.likes_count - 1\r\n            }, ...data[post_id].slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(deletePostCommentMount, (state, {post_id, comment_id}) => {\r\n        const data = {...state.data}\r\n        const idx = data[post_id].findIndex(item => item.id === comment_id)\r\n        \r\n        if (data[post_id]) {\r\n            if (idx !== -1 && idx !== false) {\r\n                data[post_id] = [...data[post_id].splice(0, idx), ...data[post_id].splice(idx + 1)]\r\n            }\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n\r\nconst $commentReplyList = createStore({loading: false, data: [], result: {}, error: false})\r\n    .on(fetchCommentReplyList.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchCommentReplyList.fail, (state, {error}) => ({\r\n        ...state, error, data: {}, result: {}\r\n    }))\r\n    .on(fetchCommentReplyList.done, (state, {result}) => {\r\n        \r\n        return {...state, data: result.data.results, result: result.data}\r\n    })\r\n\r\n\r\nexport const $postModel = combine({\r\n    $getPost,\r\n    $postOfferings,\r\n    $getPostComments,\r\n    $commentReplyList\r\n})"]},"metadata":{},"sourceType":"module"}