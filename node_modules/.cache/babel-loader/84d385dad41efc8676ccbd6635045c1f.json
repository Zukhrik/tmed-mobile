{"ast":null,"code":"var _jsxFileName = \"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/src/Views/OrganizationPage/OfferingsList/index.jsx\";\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useStore } from 'effector-react';\nimport { useParams } from 'react-router-dom';\nimport { $appModel, changeSpecPanel, switchOrgGroupPanel } from '../../../Models/app';\nimport { useOfferingList } from '../../../Hooks/offerings';\nimport { OverlaySettings } from '../../../Components/Overlay';\nimport InfiniteScroll from 'react-infinite-scroll-component';\nimport { OverlayAuth } from '../../../UIComponents/OverlayAuth';\nimport { generateSkeleton } from '../../../utils/skeleton-utils';\nimport { useOrgOrder, useOrgOrderList } from '../../../Hooks/order';\nimport { OverlayOfferingGroup, OverlaySpecialists } from '../../../Components/Offering/OrgOfferings';\nimport { useBodyOverflowHidden, useUrlParams } from '../../../Hooks/app';\nimport { useInfiniteQuery, useMutation } from 'react-query';\nimport orgApi from '../../../Service-v2/organization';\nimport { numberFormat } from '../../../utils/number-utils';\nimport { ProductCard, ProductCardSkeleton } from '../../../Components/Cards';\nimport { EmptyContainerWrapper } from '../../../UIComponents/GlobalStyles';\nimport { NoOfferingSvg } from '../../../Icons/NoOffering';\nimport { URL_KEYS } from '../../../Constants';\nimport { Col, Row } from 'antd';\nimport order from '../../../Service/order';\nimport { queryClient } from '../../../App';\nconst skeleton = generateSkeleton(10, 100, 220);\nexport const OfferingsList = () => {\n  useOrgOrderList();\n  const {\n    urlData,\n    specialist_id: specId\n  } = useUrlParams();\n  const {\n    organization\n  } = useParams();\n  const spec = urlData[URL_KEYS.SPECIALIST_ID];\n  const search = urlData[URL_KEYS.SEARCH];\n  const {\n    loadMoreOfferingGroup\n  } = useOfferingList();\n  const [auth, setAuth] = useState(false);\n  const {\n    currency,\n    checkoutOffering\n  } = useOrgOrder();\n  const [query, setQuery] = useState(null);\n  const group = urlData[URL_KEYS.OFFERING_GROUP_ID];\n  const [offeringItem, setOfferingItem] = useState(false);\n  const {\n    $app: {\n      token,\n      changeOrgGroupPanel,\n      showSpecPanel\n    }\n  } = useStore($appModel);\n  useBodyOverflowHidden(changeOrgGroupPanel || showSpecPanel);\n  const create = useMutation(order.postOrgOrderCart, {\n    onMutate: itemId => {\n      queryClient.cancelQueries(['/org/offerings', organization]);\n      const previousTodo = queryClient.getQueryData(['/org/offerings', organization]);\n      queryClient.setQueryData(['/org/offerings', organization], console.log(queryClient));\n      return () => queryClient.setQueryData(['/org/offerings', organization], previousTodo);\n    },\n    onError: (err, itemId, rollback) => rollback(),\n    onSettled: itemId => {\n      queryClient.invalidateQueries(['/org/offerings', organization]);\n    }\n  });\n  const remove = useMutation(order.deleteOrderCart, {\n    onMutate: itemId => {\n      queryClient.cancelQueries(['/org/offerings', organization]);\n      const previousTodo = queryClient.getQueryData(['/org/offerings', organization]);\n      queryClient.setQueryData(['/org/offerings', organization]);\n      return () => queryClient.setQueryData(['/org/offerings', organization], previousTodo);\n    },\n    onError: (err, newData, rollback) => rollback(),\n    onSettled: itemId => {\n      queryClient.invalidateQueries(['/org/offerings', organization]);\n    }\n  });\n  useEffect(() => {\n    let timeout = null;\n    timeout = setTimeout(() => {\n      const tmp = {};\n\n      if (group) {\n        tmp['group'] = group;\n      }\n\n      if (spec) {\n        tmp['responsible'] = spec;\n      }\n\n      if (search) {\n        tmp['search'] = search;\n      }\n\n      setQuery(tmp);\n    }, 300);\n    return () => {\n      clearTimeout(timeout);\n      timeout = null;\n    };\n  }, [group, spec, search]);\n  const {\n    isLoading,\n    hasNextPage,\n    fetchNextPage,\n    data\n  } = useInfiniteQuery(['/org/offerings', organization, query], async ({\n    pageParam = 0\n  }) => {\n    let params = {\n      limit: 10,\n      offset: pageParam\n    };\n\n    if (query) {\n      params = { ...params,\n        ...query\n      };\n    }\n\n    const res = await orgApi.getOrgOffering({\n      slug: organization,\n      params\n    });\n    return { ...res.data,\n      nextOffset: pageParam + 10\n    };\n  }, {\n    enabled: !!(organization && query),\n    getNextPageParam: data => {\n      if (data.count > data.nextOffset) {\n        return data === null || data === void 0 ? void 0 : data.nextOffset;\n      } else {\n        return undefined;\n      }\n    }\n  });\n  const onCreatingCartItem = useCallback(event => {\n    const orgSpecList = event.responsible;\n\n    if (event.inCart) {\n      remove.mutate({\n        offering_id: event.id\n      });\n    } else {\n      const params = {\n        org_slug_name: event.organization,\n        data: {\n          offering_id: event.id,\n          responsible_id: specId ? specId : orgSpecList[0].id\n        }\n      };\n      create.mutate(params);\n    }\n  }, [create, specId, remove]);\n\n  const handleClose = () => {\n    if (auth) {\n      setAuth(false);\n    }\n\n    setOfferingItem(false);\n  };\n\n  const list = useMemo(() => {\n    if ((data === null || data === void 0 ? void 0 : data.pages) && (data === null || data === void 0 ? void 0 : data.pages.length) > 0) {\n      const arr = data === null || data === void 0 ? void 0 : data.pages;\n      let tmp = [];\n\n      for (let g of arr) {\n        if (g === null || g === void 0 ? void 0 : g.result) {\n          tmp = [...tmp, ...g.result];\n        }\n      }\n\n      return tmp;\n    }\n\n    return [];\n  }, [data]);\n  const dataLength = useMemo(() => {\n    var _data$pages;\n\n    return (data === null || data === void 0 ? void 0 : data.pages) ? ((_data$pages = data.pages[data.pages.length - 1]) === null || _data$pages === void 0 ? void 0 : _data$pages.nextOffset) || 10 : 10;\n  }, [data]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(OverlaySettings, {\n    openSettings: changeOrgGroupPanel,\n    content: /*#__PURE__*/React.createElement(OverlayOfferingGroup, {\n      loadMore: loadMoreOfferingGroup,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 26\n      }\n    }),\n    onClose: () => switchOrgGroupPanel(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(OverlaySettings, {\n    openSettings: showSpecPanel,\n    onClose: () => changeSpecPanel(false),\n    content: /*#__PURE__*/React.createElement(OverlaySpecialists, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 26\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(OverlaySettings, {\n    openSettings: offeringItem,\n    onClose: handleClose,\n    content: /*#__PURE__*/React.createElement(OverlayAuth, {\n      action: () => checkoutOffering(offeringItem),\n      auth: auth,\n      setAuth: setAuth,\n      onClose: handleClose,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 26\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(InfiniteScroll, {\n    next: () => fetchNextPage(),\n    dataLength: dataLength,\n    hasMore: !isLoading && !!hasNextPage,\n    loader: /*#__PURE__*/React.createElement(React.Fragment, null, \"...loading\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: [12, 12],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, !isLoading ? (list === null || list === void 0 ? void 0 : list.length) > 0 && list.map((item, idx) => {\n    const offeringData = {\n      id: item.id,\n      qty: item.qty,\n      name: item.name,\n      image: item.image,\n      currency: currency,\n      loading: create.isLoading,\n      inCart: item.is_in_cart,\n      organization: organization,\n      cost: numberFormat(item.cost),\n      responsible: item.responsible,\n      path: `/${organization}/offerings/${item.id}`\n    };\n    return /*#__PURE__*/React.createElement(Col, {\n      span: 12,\n      key: idx + 1,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(ProductCard, {\n      showBag: true,\n      isLoading: isLoading,\n      item: offeringData,\n      handleClick: item => {\n        !!token ? onCreatingCartItem(item) : setOfferingItem(item);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 45\n      }\n    }));\n  }) : skeleton.map((item, idx) => /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    key: idx + 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(ProductCardSkeleton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 41\n    }\n  }))))), list && (list === null || list === void 0 ? void 0 : list.length) === 0 && /*#__PURE__*/React.createElement(EmptyContainerWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(NoOfferingSvg, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 25\n    }\n  })));\n};","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/src/Views/OrganizationPage/OfferingsList/index.jsx"],"names":["React","useCallback","useEffect","useMemo","useState","useStore","useParams","$appModel","changeSpecPanel","switchOrgGroupPanel","useOfferingList","OverlaySettings","InfiniteScroll","OverlayAuth","generateSkeleton","useOrgOrder","useOrgOrderList","OverlayOfferingGroup","OverlaySpecialists","useBodyOverflowHidden","useUrlParams","useInfiniteQuery","useMutation","orgApi","numberFormat","ProductCard","ProductCardSkeleton","EmptyContainerWrapper","NoOfferingSvg","URL_KEYS","Col","Row","order","queryClient","skeleton","OfferingsList","urlData","specialist_id","specId","organization","spec","SPECIALIST_ID","search","SEARCH","loadMoreOfferingGroup","auth","setAuth","currency","checkoutOffering","query","setQuery","group","OFFERING_GROUP_ID","offeringItem","setOfferingItem","$app","token","changeOrgGroupPanel","showSpecPanel","create","postOrgOrderCart","onMutate","itemId","cancelQueries","previousTodo","getQueryData","setQueryData","console","log","onError","err","rollback","onSettled","invalidateQueries","remove","deleteOrderCart","newData","timeout","setTimeout","tmp","clearTimeout","isLoading","hasNextPage","fetchNextPage","data","pageParam","params","limit","offset","res","getOrgOffering","slug","nextOffset","enabled","getNextPageParam","count","undefined","onCreatingCartItem","event","orgSpecList","responsible","inCart","mutate","offering_id","id","org_slug_name","responsible_id","handleClose","list","pages","length","arr","g","result","dataLength","map","item","idx","offeringData","qty","name","image","loading","is_in_cart","cost","path"],"mappings":"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","sourcesContent":["import React, {useCallback, useEffect, useMemo, useState} from 'react'\r\nimport {useStore} from 'effector-react'\r\nimport {useParams} from 'react-router-dom'\r\nimport {$appModel, changeSpecPanel, switchOrgGroupPanel} from '../../../Models/app'\r\nimport {useOfferingList} from '../../../Hooks/offerings'\r\nimport {OverlaySettings} from '../../../Components/Overlay'\r\nimport InfiniteScroll from 'react-infinite-scroll-component'\r\nimport {OverlayAuth} from '../../../UIComponents/OverlayAuth'\r\nimport {generateSkeleton} from '../../../utils/skeleton-utils'\r\nimport {useOrgOrder, useOrgOrderList} from '../../../Hooks/order'\r\nimport {OverlayOfferingGroup, OverlaySpecialists} from '../../../Components/Offering/OrgOfferings'\r\nimport {useBodyOverflowHidden, useUrlParams} from '../../../Hooks/app'\r\nimport {useInfiniteQuery, useMutation} from 'react-query'\r\nimport orgApi from '../../../Service-v2/organization'\r\nimport {numberFormat} from '../../../utils/number-utils'\r\nimport {ProductCard, ProductCardSkeleton} from '../../../Components/Cards'\r\nimport {EmptyContainerWrapper} from '../../../UIComponents/GlobalStyles'\r\nimport {NoOfferingSvg} from '../../../Icons/NoOffering'\r\nimport {URL_KEYS} from '../../../Constants'\r\nimport {Col, Row} from 'antd'\r\nimport order from '../../../Service/order'\r\nimport {queryClient} from '../../../App'\r\n\r\nconst skeleton = generateSkeleton(10, 100, 220)\r\nexport const OfferingsList = () => {\r\n    useOrgOrderList()\r\n    const {urlData, specialist_id: specId} = useUrlParams()\r\n    const {organization} = useParams()\r\n    const spec = urlData[URL_KEYS.SPECIALIST_ID]\r\n    const search = urlData[URL_KEYS.SEARCH]\r\n    const {loadMoreOfferingGroup} = useOfferingList()\r\n    const [auth, setAuth] = useState(false)\r\n    const {currency, checkoutOffering} = useOrgOrder()\r\n    const [query, setQuery] = useState(null)\r\n    const group = urlData[URL_KEYS.OFFERING_GROUP_ID]\r\n    const [offeringItem, setOfferingItem] = useState(false)\r\n    const {$app: {token, changeOrgGroupPanel, showSpecPanel}} = useStore($appModel)\r\n    useBodyOverflowHidden(changeOrgGroupPanel || showSpecPanel)\r\n    \r\n    const create = useMutation(order.postOrgOrderCart, {\r\n        onMutate: itemId => {\r\n            queryClient.cancelQueries(['/org/offerings', organization])\r\n            \r\n            const previousTodo = queryClient.getQueryData(['/org/offerings', organization])\r\n            \r\n            queryClient.setQueryData(['/org/offerings', organization], console.log(queryClient))\r\n            \r\n            return () => queryClient.setQueryData(['/org/offerings', organization], previousTodo)\r\n        },\r\n        onError: (err, itemId, rollback) => rollback(),\r\n        onSettled: itemId => {\r\n            queryClient.invalidateQueries(['/org/offerings', organization])\r\n        }\r\n    })\r\n    \r\n    const remove = useMutation(order.deleteOrderCart, {\r\n        onMutate: itemId => {\r\n            queryClient.cancelQueries(['/org/offerings', organization])\r\n            \r\n            const previousTodo = queryClient.getQueryData(['/org/offerings', organization])\r\n            \r\n            queryClient.setQueryData(['/org/offerings', organization])\r\n            \r\n            return () => queryClient.setQueryData(['/org/offerings', organization], previousTodo)\r\n        },\r\n        onError: (err, newData, rollback) => rollback(),\r\n        onSettled: itemId => {\r\n            queryClient.invalidateQueries(['/org/offerings', organization])\r\n        }\r\n    })\r\n    \r\n    useEffect(() => {\r\n        let timeout = null\r\n        timeout = setTimeout(() => {\r\n            const tmp = {}\r\n            if (group) {\r\n                tmp['group'] = group\r\n            }\r\n            if (spec) {\r\n                tmp['responsible'] = spec\r\n            }\r\n            if (search) {\r\n                tmp['search'] = search\r\n            }\r\n            setQuery(tmp)\r\n        }, 300)\r\n        \r\n        return () => {\r\n            clearTimeout(timeout)\r\n            timeout = null\r\n        }\r\n    }, [group, spec, search])\r\n    \r\n    const {isLoading, hasNextPage, fetchNextPage, data} = useInfiniteQuery(\r\n        ['/org/offerings', organization, query],\r\n        async ({pageParam = 0}) => {\r\n            \r\n            let params = {\r\n                limit: 10,\r\n                offset: pageParam\r\n            }\r\n            \r\n            if (query) {\r\n                params = {...params, ...query}\r\n            }\r\n            const res = await orgApi.getOrgOffering({slug: organization, params})\r\n            return {...res.data, nextOffset: pageParam + 10}\r\n        },\r\n        {\r\n            enabled: !!(organization && query),\r\n            getNextPageParam: (data) => {\r\n                if (data.count > data.nextOffset) {\r\n                    return data?.nextOffset\r\n                } else {\r\n                    return undefined\r\n                }\r\n            }\r\n        }\r\n    )\r\n    \r\n    const onCreatingCartItem = useCallback((event) => {\r\n        const orgSpecList = event.responsible\r\n        if (event.inCart) {\r\n            remove.mutate({offering_id: event.id})\r\n        } else {\r\n            const params = {\r\n                org_slug_name: event.organization,\r\n                data: {\r\n                    offering_id: event.id,\r\n                    responsible_id: specId ? specId : orgSpecList[0].id\r\n                }\r\n            }\r\n            create.mutate(params)\r\n        }\r\n    }, [create, specId, remove])\r\n    \r\n    const handleClose = () => {\r\n        if (auth) {\r\n            setAuth(false)\r\n        }\r\n        setOfferingItem(false)\r\n    }\r\n    \r\n    const list = useMemo(() => {\r\n        if (data?.pages && data?.pages.length > 0) {\r\n            const arr = data?.pages\r\n            let tmp = []\r\n            for (let g of arr) {\r\n                if (g?.result) {\r\n                    tmp = [...tmp, ...g.result]\r\n                }\r\n            }\r\n            return tmp\r\n        }\r\n        return []\r\n    }, [data])\r\n    \r\n    const dataLength = useMemo(() => {\r\n        return data?.pages ? data.pages[data.pages.length - 1]?.nextOffset || 10 : 10\r\n    }, [data])\r\n    \r\n    return (\r\n        <>\r\n            <OverlaySettings\r\n                openSettings={changeOrgGroupPanel}\r\n                content={<OverlayOfferingGroup loadMore={loadMoreOfferingGroup}/>}\r\n                onClose={() => switchOrgGroupPanel(false)}\r\n            />\r\n            <OverlaySettings\r\n                openSettings={showSpecPanel}\r\n                onClose={() => changeSpecPanel(false)}\r\n                content={<OverlaySpecialists/>}\r\n            />\r\n            <OverlaySettings\r\n                openSettings={offeringItem}\r\n                onClose={handleClose}\r\n                content={<OverlayAuth\r\n                    action={() => checkoutOffering(offeringItem)}\r\n                    auth={auth}\r\n                    setAuth={setAuth}\r\n                    onClose={handleClose}\r\n                />}\r\n            />\r\n            <InfiniteScroll\r\n                next={() => fetchNextPage()}\r\n                dataLength={dataLength}\r\n                hasMore={!isLoading && !!hasNextPage}\r\n                loader={<>...loading</>}\r\n            >\r\n                <Row gutter={[12, 12]}>\r\n                    {\r\n                        !isLoading\r\n                            ? (\r\n                                list?.length > 0 && list.map((item, idx) => {\r\n                                    const offeringData = {\r\n                                        id: item.id,\r\n                                        qty: item.qty,\r\n                                        name: item.name,\r\n                                        image: item.image,\r\n                                        currency: currency,\r\n                                        loading: create.isLoading,\r\n                                        inCart: item.is_in_cart,\r\n                                        organization: organization,\r\n                                        cost: numberFormat(item.cost),\r\n                                        responsible: item.responsible,\r\n                                        path: `/${organization}/offerings/${item.id}`\r\n                                    }\r\n                                    return (\r\n                                        <Col span={12} key={idx + 1}>\r\n                                            <ProductCard\r\n                                                showBag\r\n                                                isLoading={isLoading}\r\n                                                item={offeringData}\r\n                                                handleClick={(item) => {\r\n                                                    !!token\r\n                                                        ? onCreatingCartItem(item)\r\n                                                        : setOfferingItem(item)\r\n                                                }}\r\n                                            />\r\n                                        </Col>\r\n                                    )\r\n                                })\r\n                            ) : (\r\n                                skeleton.map((item, idx) => (\r\n                                    <Col span={12} key={idx + 1}>\r\n                                        <ProductCardSkeleton/>\r\n                                    </Col>\r\n                                ))\r\n                            )\r\n                    }\r\n                </Row>\r\n            </InfiniteScroll>\r\n            {\r\n                list && list?.length === 0 && (\r\n                    <EmptyContainerWrapper>\r\n                        <NoOfferingSvg/>\r\n                    </EmptyContainerWrapper>\r\n                )\r\n            }\r\n        </>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}