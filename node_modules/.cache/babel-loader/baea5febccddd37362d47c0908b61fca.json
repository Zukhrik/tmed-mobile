{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useRef,useState}from'react';import{useFormik}from'formik';import{$chatModel,temporaryMessageMount,userSentMessageMount,userUpdateMessageMount}from'../../Models/chat-model';import{v4 as uuidV4}from'uuid';import moment from'moment';import{useStore}from'effector-react';import{$accountModel}from'../../Models/account-model';import{useOutsideClicker}from'../app/use-outside-clicker';import{useTranslation}from'react-i18next';export function useChatInput(_ref){var partner_slug=_ref.partner_slug;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useStore=useStore($chatModel),tmpMsg=_useStore.$temporaryMessage;var uploadRef=useRef(null);var inputRef=useRef(null);var inputWrapperRef=useRef(null);var _useState=useState(),_useState2=_slicedToArray(_useState,2),modalIsOpen=_useState2[0],setModalIsOpen=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),iosHeight=_useState4[0],setIosHeight=_useState4[1];var _useStore2=useStore($accountModel),currentProfile=_useStore2.$profiles.currentProfile;var _useOutsideClicker=useOutsideClicker(inputWrapperRef),clicked=_useOutsideClicker.clicked;var formik=useFormik({initialValues:{text:'',caption:'',file:''},onSubmit:function onSubmit(_ref2,_ref3){var text=_ref2.text;var resetForm=_ref3.resetForm;var formData=new FormData();formData.append('text',text);var date=moment().format('YYYY-MM-DD HH:mm');var temporaryId=uuidV4();if(!tmpMsg){var payload={text:text,date:date,file:null,sender:{username:currentProfile.slug_name}};userSentMessageMount({partner:partner_slug,data:formData,uuid:temporaryId,payload:payload,file:null,onUploadProgress:function onUploadProgress(evt){console.log(evt);}});}if(tmpMsg){if(tmpMsg.type==='edit'){var _payload=_objectSpread(_objectSpread({},tmpMsg),{},{updated:date,text:text});userUpdateMessageMount({id:tmpMsg.id,data:{text:text},partner:partner_slug,payload:_payload});}if(tmpMsg.type==='reply'){var _payload2={text:text,id:temporaryId,date:moment().format('YYYY-MM-DD HH:mm'),sender:tmpMsg.sender,reply_to:{sender:tmpMsg.sender,text:tmpMsg.text}};formData.append('reply_to_id',tmpMsg.id);userSentMessageMount({partner:partner_slug,data:formData,uuid:temporaryId,payload:_payload2});}}resetForm();inputRef.current.focus();temporaryMessageMount(null);}});var disableScroll=useCallback(function(){if(!modalIsOpen){window.scroll(0,0);}},[modalIsOpen]);useEffect(function(){window.addEventListener('scroll',disableScroll);return function(){window.removeEventListener('scroll',disableScroll);};},[disableScroll]);useEffect(function(){document.body.style.overflow='hidden';},[]);var handleFocus=function handleFocus(){if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&/Mobile/.test(navigator.userAgent)){setIosHeight(252);}else{setIosHeight(0);}};var handleCancelModal=function handleCancelModal(){formik.resetForm();setModalIsOpen(false);};var getTitle=useCallback(function(){var title='';var file=formik.values.file;if(file){if(file.type.indexOf('image')!==-1){title=t('send_photo');}}return title;},[formik,t]);var handleGetFile=function handleGetFile(file){formik.setFieldValue('file',file);setModalIsOpen(true);};useEffect(function(){if(clicked){inputRef.current.blur();setIosHeight(0);}},[clicked]);return{handleFocus:handleFocus,uploadRef:uploadRef,inputRef:inputRef,formik:formik,inputWrapperRef:inputWrapperRef,iosHeight:iosHeight,setModalIsOpen:setModalIsOpen,modalIsOpen:modalIsOpen,handleCancelModal:handleCancelModal,getTitle:getTitle,handleGetFile:handleGetFile};}","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Hooks/chat/use-chat-input.js"],"names":["useCallback","useEffect","useRef","useState","useFormik","$chatModel","temporaryMessageMount","userSentMessageMount","userUpdateMessageMount","v4","uuidV4","moment","useStore","$accountModel","useOutsideClicker","useTranslation","useChatInput","partner_slug","t","tmpMsg","$temporaryMessage","uploadRef","inputRef","inputWrapperRef","modalIsOpen","setModalIsOpen","iosHeight","setIosHeight","currentProfile","$profiles","clicked","formik","initialValues","text","caption","file","onSubmit","resetForm","formData","FormData","append","date","format","temporaryId","payload","sender","username","slug_name","partner","data","uuid","onUploadProgress","evt","console","log","type","updated","id","reply_to","current","focus","disableScroll","window","scroll","addEventListener","removeEventListener","document","body","style","overflow","handleFocus","test","navigator","userAgent","handleCancelModal","getTitle","title","values","indexOf","handleGetFile","setFieldValue","blur"],"mappings":"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","sourcesContent":["import {useCallback, useEffect, useRef, useState} from 'react'\nimport {useFormik} from 'formik'\nimport {$chatModel, temporaryMessageMount, userSentMessageMount, userUpdateMessageMount} from '../../Models/chat-model'\nimport {v4 as uuidV4} from 'uuid'\nimport moment from 'moment'\nimport {useStore} from 'effector-react'\nimport {$accountModel} from '../../Models/account-model'\nimport {useOutsideClicker} from '../app/use-outside-clicker'\nimport {useTranslation} from 'react-i18next'\n\nexport function useChatInput({partner_slug}) {\n    const {t} = useTranslation()\n    const {$temporaryMessage: tmpMsg} = useStore($chatModel)\n    const uploadRef = useRef(null)\n    const inputRef = useRef(null)\n    const inputWrapperRef = useRef(null)\n    const [modalIsOpen, setModalIsOpen] = useState()\n    const [iosHeight, setIosHeight] = useState(0)\n    const {$profiles: {currentProfile}} = useStore($accountModel)\n\n    const {clicked} = useOutsideClicker(inputWrapperRef)\n\n    const formik = useFormik({\n        initialValues: {\n            text: '',\n            caption: '',\n            file: ''\n        },\n        onSubmit({text}, {resetForm}) {\n            const formData = new FormData()\n            formData.append('text', text)\n            const date = moment().format('YYYY-MM-DD HH:mm')\n            const temporaryId = uuidV4()\n            if (!tmpMsg) {\n                const payload = {\n                    text,\n                    date,\n                    file: null,\n                    sender: {username: currentProfile.slug_name}\n                }\n                userSentMessageMount({\n                    partner: partner_slug,\n                    data: formData,\n                    uuid: temporaryId,\n                    payload,\n                    file: null,\n                    onUploadProgress: (evt) => {\n                        console.log(evt)\n                    }\n                })\n            }\n\n            if (tmpMsg) {\n                if (tmpMsg.type === 'edit') {\n                    const payload = {\n                        ...tmpMsg,\n                        updated: date,\n                        text\n                    }\n                    userUpdateMessageMount({id: tmpMsg.id, data: {text}, partner: partner_slug, payload})\n                }\n\n                if (tmpMsg.type === 'reply') {\n                    const payload = {\n                        text,\n                        id: temporaryId,\n                        date: moment().format('YYYY-MM-DD HH:mm'),\n                        sender: tmpMsg.sender,\n                        reply_to: {\n                            sender: tmpMsg.sender,\n                            text: tmpMsg.text\n                        }\n                    }\n                    formData.append('reply_to_id', tmpMsg.id)\n                    userSentMessageMount({partner: partner_slug, data: formData, uuid: temporaryId, payload})\n                }\n            }\n\n\n            resetForm()\n            inputRef.current.focus()\n            temporaryMessageMount(null)\n        }\n    })\n\n\n    const disableScroll = useCallback(() => {\n        if (!modalIsOpen) {\n            window.scroll(0, 0)\n        }\n    }, [modalIsOpen])\n\n    useEffect(() => {\n        window.addEventListener('scroll', disableScroll)\n\n        return () => {\n            window.removeEventListener('scroll', disableScroll)\n        }\n    }, [disableScroll])\n\n    useEffect(() => {\n        document.body.style.overflow = 'hidden'\n    }, [])\n\n    const handleFocus = () => {\n        if (/iPad|iPhone|iPod/.test(navigator.userAgent) && /Mobile/.test(navigator.userAgent)) {\n            setIosHeight(252)\n        } else {\n            setIosHeight(0)\n        }\n    }\n\n    const handleCancelModal = () => {\n        formik.resetForm()\n        setModalIsOpen(false)\n    }\n\n    const getTitle = useCallback(() => {\n        let title = ''\n        const file = formik.values.file\n\n        if (file) {\n            if (file.type.indexOf('image') !== -1) {\n                title = t('send_photo')\n            }\n        }\n\n        return title\n    }, [formik, t])\n\n    const handleGetFile = (file) => {\n        formik.setFieldValue('file', file)\n        setModalIsOpen(true)\n    }\n\n    useEffect(() => {\n        if (clicked) {\n            inputRef.current.blur()\n            setIosHeight(0)\n        }\n    }, [clicked])\n\n    return {\n        handleFocus,\n        uploadRef,\n        inputRef,\n        formik,\n        inputWrapperRef,\n        iosHeight,\n        setModalIsOpen,\n        modalIsOpen,\n        handleCancelModal,\n        getTitle,\n        handleGetFile\n    }\n}\n\n"]},"metadata":{},"sourceType":"module"}