{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{combine,createStore}from'effector';import{fetchAccountAvatars,fetchAccountCoupons,fetchAccountInfo,fetchAccountPData,fetchAccountVerify,fetchUpdateAccount}from'./effects';import Cookies from'js-cookie';import jwtDecode from'jwt-decode';import{getAccountInfo,getLinkedUsers,getOrganizations,getSpecialisms,getSpecOrganizations,getUpdated}from'./helper';import{PROFILE_TYPE}from'../../Constants';import{getCurrentAccount}from'./events';var $accountInfo=createStore({loading:false,data:null,error:false}).on(fetchAccountInfo.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAccountInfo.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{}});}).on(fetchAccountInfo.done,function(state,res){return _objectSpread(_objectSpread({},state),{},{data:res.result.data,error:false});});var $accountAvatars=createStore({loading:false,result:{},data:[],error:false}).on(fetchAccountAvatars.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAccountAvatars.fail,function(state,_ref2){var error=_ref2.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{}});}).on(fetchAccountAvatars.done,function(state,res){return _objectSpread(_objectSpread({},state),{},{data:res.result.data.results,error:false});});var $accountPData=createStore({loading:false,data:null,error:false}).on(fetchAccountPData.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAccountPData.fail,function(state,_ref3){var error=_ref3.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[]});}).on(fetchAccountPData.done,function(state,res){return _objectSpread(_objectSpread({},state),{},{data:res.result.data,error:false});});var $accountVideoVerify=createStore({loading:false,data:{},error:false}).on(fetchAccountVerify.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAccountVerify.fail,function(state,_ref4){var error=_ref4.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{}});}).on(fetchAccountVerify.done,function(state,_ref5){var result=_ref5.result;return _objectSpread(_objectSpread({},state),{},{data:result});});var currentProfile=localStorage.getItem('currentProfile');var $profiles=createStore({currentProfile:currentProfile?JSON.parse(currentProfile):null,linkedUsers:[],organizations:[],accountInfo:{},specialisms:[]}).on(fetchAccountInfo.done,function(state,_ref6){var data=_ref6.result.data,params=_ref6.params;var slug_name=jwtDecode(Cookies.get('token')).username;var accountInfo=getAccountInfo(data,slug_name);var linkedUsers=[_objectSpread({},accountInfo)].concat(_toConsumableArray(getLinkedUsers(data.linked_users))).sort(function(a,b){return a.slug_name.localeCompare(b.slug_name);});var specialisms=getSpecialisms(data.specialisms,slug_name);var organizations=[].concat(_toConsumableArray(getOrganizations(data.organizations,data)),_toConsumableArray(getSpecOrganizations(data.specialisms,data)));if(params&&params.actions){params.actions();}var info={category:data.main_cat,lang:data.user_lang,region:data.region,status:data.status,avatar:data.avatar,currency:data.currency||null};if(params&&params.actions){params.actions();}var currentAccount;if(state.currentProfile){if(state.currentProfile.type===PROFILE_TYPE.USER){currentAccount=_objectSpread(_objectSpread({},state.currentProfile),info);}else{var organization=organizations.find(function(item){return item.slug_name===state.currentProfile.slug_name;});if(organization){currentAccount=_objectSpread(_objectSpread({},state.currentProfile),{},{status:organization.status,category:organization.category,region:organization.region});}else{currentAccount=state.currentProfile;}}}else{currentAccount=accountInfo;}return _objectSpread(_objectSpread({},state),{},{accountInfo:accountInfo,linkedUsers:linkedUsers,specialisms:specialisms,organizations:organizations,currentProfile:currentAccount});}).on(getCurrentAccount,function(state){var payloads=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var currentAccount=null;var organizations=state.organizations,linkedUsers=state.linkedUsers;if(payloads){var type=payloads.type,slug_name=payloads.slug_name;if(type===PROFILE_TYPE.ORGANIZATION){currentAccount=organizations.find(function(item){return item.slug_name===slug_name;});}if(type===PROFILE_TYPE.USER){currentAccount=linkedUsers.find(function(item){return item.slug_name===slug_name;});}}return _objectSpread(_objectSpread({},state),{},{currentProfile:currentAccount});}).on(fetchUpdateAccount.done,function(state,_ref7){var result=_ref7.result.data,params=_ref7.params;if(params&&params.actions){params.actions();}var currentProfile=state.currentProfile,linkedUsers=state.linkedUsers,accountInfo=state.accountInfo;var data={category:result.main_cat,lang:result.user_lang,region:result.region,status:result.status,currency:result.currency||null};return _objectSpread(_objectSpread({},state),{},{accountInfo:_objectSpread(_objectSpread({},accountInfo),data),currentProfile:_objectSpread(_objectSpread({},currentProfile),data),linkedUsers:getUpdated(linkedUsers,currentProfile.slug_name,data)});}).on(fetchUpdateAccount.fail,function(state,_ref8){var params=_ref8.params;if(params&&params.actions){params.actions(true);}return _objectSpread({},state);});$profiles.watch(function(state){var currentProfile=state.currentProfile;if(currentProfile&&Object.values(currentProfile).length>0){localStorage.setItem('currentProfile',JSON.stringify(currentProfile));}else{localStorage.removeItem('currentProfile');}});var $accountCoupons=createStore({loading:false,data:[],error:false}).on(fetchAccountCoupons.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAccountCoupons.fail,function(state,_ref9){var error=_ref9.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[]});}).on(fetchAccountCoupons.done,function(state,_ref10){var result=_ref10.result;return _objectSpread(_objectSpread({},state),{},{data:result.data});});export var $accountModel=combine({$profiles:$profiles,$accountInfo:$accountInfo,$accountPData:$accountPData,$accountAvatars:$accountAvatars,$accountCoupons:$accountCoupons,$accountVideoVerify:$accountVideoVerify});","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Models/account-model/stores.js"],"names":["combine","createStore","fetchAccountAvatars","fetchAccountCoupons","fetchAccountInfo","fetchAccountPData","fetchAccountVerify","fetchUpdateAccount","Cookies","jwtDecode","getAccountInfo","getLinkedUsers","getOrganizations","getSpecialisms","getSpecOrganizations","getUpdated","PROFILE_TYPE","getCurrentAccount","$accountInfo","loading","data","error","on","pending","state","fail","done","res","result","$accountAvatars","results","$accountPData","$accountVideoVerify","currentProfile","localStorage","getItem","$profiles","JSON","parse","linkedUsers","organizations","accountInfo","specialisms","params","slug_name","get","username","linked_users","sort","a","b","localeCompare","actions","info","category","main_cat","lang","user_lang","region","status","avatar","currency","currentAccount","type","USER","organization","find","item","payloads","ORGANIZATION","watch","Object","values","length","setItem","stringify","removeItem","$accountCoupons","$accountModel"],"mappings":"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","sourcesContent":["import {combine, createStore} from 'effector'\r\nimport {\r\n    fetchAccountAvatars,\r\n    fetchAccountCoupons,\r\n    fetchAccountInfo,\r\n    fetchAccountPData,\r\n    fetchAccountVerify,\r\n    fetchUpdateAccount\r\n} from './effects'\r\nimport Cookies from 'js-cookie'\r\nimport jwtDecode from 'jwt-decode'\r\nimport {\r\n    getAccountInfo,\r\n    getLinkedUsers,\r\n    getOrganizations,\r\n    getSpecialisms,\r\n    getSpecOrganizations,\r\n    getUpdated\r\n} from './helper'\r\nimport {PROFILE_TYPE} from '../../Constants'\r\nimport {getCurrentAccount} from './events'\r\n\r\n\r\nconst $accountInfo = createStore({loading: false, data: null, error: false})\r\n    .on(fetchAccountInfo.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAccountInfo.fail, (state, {error}) => ({\r\n        ...state, error, data: {}\r\n    }))\r\n    .on(fetchAccountInfo.done, (state, res) => ({\r\n        ...state, data: res.result.data, error: false\r\n    }))\r\n\r\nconst $accountAvatars = createStore({loading: false, result: {}, data: [], error: false})\r\n    .on(fetchAccountAvatars.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAccountAvatars.fail, (state, {error}) => ({\r\n        ...state, error, data: [], result: {}\r\n    }))\r\n    .on(fetchAccountAvatars.done, (state, res) => ({\r\n        ...state, data: res.result.data.results, error: false\r\n    }))\r\n\r\nconst $accountPData = createStore({loading: false, data: null, error: false})\r\n    .on(fetchAccountPData.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAccountPData.fail, (state, {error}) => ({\r\n        ...state, error, data: []\r\n    }))\r\n    .on(fetchAccountPData.done, (state, res) => ({\r\n        ...state, data: res.result.data, error: false\r\n    }))\r\n\r\nconst $accountVideoVerify = createStore({loading: false, data: {}, error: false})\r\n    .on(fetchAccountVerify.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAccountVerify.fail, (state, {error}) => ({\r\n        ...state, error, data: {}\r\n    }))\r\n    .on(fetchAccountVerify.done, (state, {result}) => {\r\n        return {\r\n            ...state,\r\n            data: result\r\n        }\r\n    })\r\n\r\nconst currentProfile = localStorage.getItem('currentProfile')\r\n\r\nconst $profiles = createStore({\r\n    currentProfile: currentProfile ? JSON.parse(currentProfile) : null,\r\n    linkedUsers: [],\r\n    organizations: [],\r\n    accountInfo: {},\r\n    specialisms: []\r\n})\r\n    .on(fetchAccountInfo.done, (state, {result: {data}, params}) => {\r\n        const slug_name = jwtDecode(Cookies.get('token')).username\r\n        const accountInfo = getAccountInfo(data, slug_name)\r\n        const linkedUsers = [{...accountInfo}, ...getLinkedUsers(data.linked_users)].sort((a, b) => {\r\n            return a.slug_name.localeCompare(b.slug_name)\r\n        })\r\n        const specialisms = getSpecialisms(data.specialisms, slug_name)\r\n        const organizations = [\r\n            ...getOrganizations(data.organizations, data),\r\n            ...getSpecOrganizations(data.specialisms, data)\r\n        ]\r\n        \r\n        if (params && params.actions) {\r\n            params.actions()\r\n        }\r\n        \r\n        const info = {\r\n            category: data.main_cat,\r\n            lang: data.user_lang,\r\n            region: data.region,\r\n            status: data.status,\r\n            avatar: data.avatar,\r\n            currency: data.currency || null\r\n        }\r\n        \r\n        if (params && params.actions) {\r\n            params.actions()\r\n        }\r\n        \r\n        let currentAccount\r\n        \r\n        if (state.currentProfile) {\r\n            if (state.currentProfile.type === PROFILE_TYPE.USER) {\r\n                currentAccount = {...state.currentProfile, ...info}\r\n            } else {\r\n                \r\n                const organization = organizations.find(item => item.slug_name === state.currentProfile.slug_name)\r\n                \r\n                if (organization) {\r\n                    currentAccount = {\r\n                        ...state.currentProfile,\r\n                        status: organization.status,\r\n                        category: organization.category,\r\n                        region: organization.region\r\n                    }\r\n                } else {\r\n                    currentAccount = state.currentProfile\r\n                }\r\n            }\r\n        } else {\r\n            currentAccount = accountInfo\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            accountInfo,\r\n            linkedUsers,\r\n            specialisms,\r\n            organizations,\r\n            currentProfile: currentAccount\r\n        }\r\n    })\r\n    .on(getCurrentAccount, (state, payloads = null) => {\r\n        let currentAccount = null\r\n        const {organizations, linkedUsers} = state\r\n        \r\n        if (payloads) {\r\n            const {type, slug_name} = payloads\r\n            if (type === PROFILE_TYPE.ORGANIZATION) {\r\n                currentAccount = organizations.find(item => item.slug_name === slug_name)\r\n            }\r\n            \r\n            if (type === PROFILE_TYPE.USER) {\r\n                currentAccount = linkedUsers.find(item => item.slug_name === slug_name)\r\n            }\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            currentProfile: currentAccount\r\n        }\r\n    })\r\n    .on(fetchUpdateAccount.done, (state, {result: {data: result}, params}) => {\r\n        if (params && params.actions) {\r\n            params.actions()\r\n        }\r\n        const {currentProfile, linkedUsers, accountInfo} = state\r\n        const data = {\r\n            category: result.main_cat,\r\n            lang: result.user_lang,\r\n            region: result.region,\r\n            status: result.status,\r\n            currency: result.currency || null\r\n        }\r\n        \r\n        return {\r\n            ...state,\r\n            accountInfo: {...accountInfo, ...data},\r\n            currentProfile: {...currentProfile, ...data},\r\n            linkedUsers: getUpdated(linkedUsers, currentProfile.slug_name, data)\r\n        }\r\n    })\r\n    .on(fetchUpdateAccount.fail, (state, {params}) => {\r\n        if (params && params.actions) {\r\n            params.actions(true)\r\n        }\r\n        return {\r\n            ...state\r\n        }\r\n    })\r\n\r\n$profiles.watch((state) => {\r\n    const {currentProfile} = state\r\n    if (currentProfile && Object.values(currentProfile).length > 0) {\r\n        localStorage.setItem('currentProfile', JSON.stringify(currentProfile))\r\n    } else {\r\n        localStorage.removeItem('currentProfile')\r\n    }\r\n})\r\n\r\n\r\nconst $accountCoupons = createStore({loading: false, data: [], error: false})\r\n    .on(fetchAccountCoupons.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAccountCoupons.fail, (state, {error}) => ({...state, error, data: []}))\r\n    .on(fetchAccountCoupons.done, (state, {result}) => {\r\n        \r\n        return {...state, data: result.data}\r\n    })\r\n\r\n\r\nexport const $accountModel = combine({\r\n    $profiles,\r\n    $accountInfo,\r\n    $accountPData,\r\n    $accountAvatars,\r\n    $accountCoupons,\r\n    $accountVideoVerify\r\n})"]},"metadata":{},"sourceType":"module"}