{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{LISTS}from'../../Constants';import{useStore}from'effector-react';import{useCallback,useEffect,useState}from'react';import{$regionModel,userRegionMount}from'../../Models/region-model';import{$categoryModel,categoryForceLoading,userCatListMount}from'../../Models/category-model';var initialParams={parent:0,params:{limit:20,offset:0,show_empties:'1'}};export function useCategory(_ref){var listType=_ref.listType,onChange=_ref.onChange,onClose=_ref.onClose;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),breadcrumb=_useState2[0],setBreadcrumb=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selected=_useState4[0],setSelected=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),parent=_useState6[0],setParent=_useState6[1];var _useStore=useStore($categoryModel),$categoryList=_useStore.$categoryList,result=_useStore.$categoryList.result;var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),list=_useState8[0],setList=_useState8[1];var _useStore2=useStore($regionModel),$userRegion=_useStore2.$userRegion;var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),searchValue=_useState10[0],setSearchValue=_useState10[1];var getList=useCallback(function(params){if(listType===LISTS.USER_CATEGORY){userCatListMount(params);}if(listType===LISTS.REGION){userRegionMount(params);}},[listType]);var getChildren=useCallback(function(item){var parentId=item.slug?item.slug:item.id;var data=_objectSpread(_objectSpread({clear:true},initialParams),{},{parent:parentId});categoryForceLoading();setParent(String(parentId));setBreadcrumb([].concat(_toConsumableArray(breadcrumb),[_objectSpread({},item)]));getList(data);},[getList,breadcrumb]);var renderList=useCallback(function(){if(listType===LISTS.USER_CATEGORY){setList($categoryList);}if(listType===LISTS.REGION){setList($userRegion);}},[listType,$categoryList,$userRegion]);var loadMore=useCallback(function(){if(result===null||result===void 0?void 0:result.nextOffset){var data=_objectSpread(_objectSpread({},initialParams),{},{parent:parent,params:_objectSpread(_objectSpread({},initialParams.params),{},{offset:result===null||result===void 0?void 0:result.nextOffset})});getList(data);}},[getList,parent,result]);var onSelect=useCallback(function(item){if(selected&&selected.id===item.id){setSelected(null);}else{setSelected(item);}},[selected]);var handleAccept=useCallback(function(){onChange(selected);onClose();},[onChange,selected,onClose]);var handleSubmit=function handleSubmit(e){e.preventDefault();if(searchValue.trim().length>0){if(listType==='user_category'){var data=_objectSpread(_objectSpread({},initialParams),{},{clear:true,params:_objectSpread(_objectSpread({},initialParams.params),{},{search:searchValue})});userCatListMount(data);}if(listType==='region'){var _data=_objectSpread(_objectSpread({},initialParams),{},{clear:true,params:_objectSpread(_objectSpread({},initialParams.params),{},{search:searchValue})});userRegionMount(_data);}}};var handleClick=function handleClick(e,id){e.preventDefault();var data=_objectSpread(_objectSpread({},initialParams),{},{parent:id,clear:true});if(id===0){setBreadcrumb([]);}else{var idx=breadcrumb.findIndex(function(item){return item.id===id;});var newData=_toConsumableArray(breadcrumb.slice(0,idx+1));setBreadcrumb(newData);}categoryForceLoading();setParent(id);getList(data);};useEffect(function(){var timeout=null;timeout=setTimeout(function(){categoryForceLoading();var data=_objectSpread({clear:true},initialParams);setBreadcrumb([]);setParent(0);getList(data);},200);return function(){clearTimeout(timeout);timeout=null;};},[getList]);useEffect(function(){renderList();},[renderList]);return{list:list,parent:parent,loadMore:loadMore,onSelect:onSelect,selected:selected,breadcrumb:breadcrumb,getChildren:getChildren,searchValue:searchValue,handleClick:handleClick,handleSubmit:handleSubmit,handleAccept:handleAccept,setSearchValue:setSearchValue};}","map":null,"metadata":{},"sourceType":"module"}