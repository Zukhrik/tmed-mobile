{"ast":null,"code":"import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/zuhriddinkamilzanov/Desktop/t-med(mobile)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useRef,useState}from'react';import{useFormik}from'formik';import{$chatModel,temporaryMessageMount,userSentMessageMount,userUpdateMessageMount}from'../../Models/chat-model';import{v4 as uuidV4}from'uuid';import moment from'moment';import{useStore}from'effector-react';import{$accountModel}from'../../Models/account-model';import{useOutsideClicker}from'../app/use-outside-clicker';import{useTranslation}from'react-i18next';export function useChatInput(_ref){var partner_slug=_ref.partner_slug;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useStore=useStore($chatModel),tmpMsg=_useStore.$temporaryMessage;var uploadRef=useRef(null);var inputRef=useRef(null);var inputWrapperRef=useRef(null);var _useState=useState(),_useState2=_slicedToArray(_useState,2),modalIsOpen=_useState2[0],setModalIsOpen=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),iosHeight=_useState4[0],setIosHeight=_useState4[1];var _useStore2=useStore($accountModel),currentProfile=_useStore2.$profiles.currentProfile;var _useOutsideClicker=useOutsideClicker(inputWrapperRef),clicked=_useOutsideClicker.clicked;var formik=useFormik({initialValues:{text:'',caption:'',file:''},onSubmit:function onSubmit(_ref2,_ref3){var text=_ref2.text;var resetForm=_ref3.resetForm;var formData=new FormData();formData.append('text',text);var date=moment().format('YYYY-MM-DD HH:mm');var temporaryId=uuidV4();if(!tmpMsg){var payload={text:text,date:date,file:null,sender:{username:currentProfile.slug_name}};userSentMessageMount({partner:partner_slug,data:formData,uuid:temporaryId,payload:payload,file:null,onUploadProgress:function onUploadProgress(evt){console.log(evt);}});}if(tmpMsg){if(tmpMsg.type==='edit'){var _payload=_objectSpread(_objectSpread({},tmpMsg),{},{updated:date,text:text});userUpdateMessageMount({id:tmpMsg.id,data:{text:text},partner:partner_slug,payload:_payload});}if(tmpMsg.type==='reply'){var _payload2={text:text,id:temporaryId,date:moment().format('YYYY-MM-DD HH:mm'),sender:tmpMsg.sender,reply_to:{sender:tmpMsg.sender,text:tmpMsg.text}};formData.append('reply_to_id',tmpMsg.id);userSentMessageMount({partner:partner_slug,data:formData,uuid:temporaryId,payload:_payload2});}}resetForm();inputRef.current.focus();temporaryMessageMount(null);}});var disableScroll=useCallback(function(){if(!modalIsOpen){window.scroll(0,0);}},[modalIsOpen]);useEffect(function(){window.addEventListener('scroll',disableScroll);return function(){window.removeEventListener('scroll',disableScroll);};},[disableScroll]);useEffect(function(){document.body.style.overflow='hidden';},[]);var handleFocus=function handleFocus(){if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&/Mobile/.test(navigator.userAgent)){setIosHeight(252);}else{setIosHeight(0);}};var handleCancelModal=function handleCancelModal(){formik.resetForm();setModalIsOpen(false);};var getTitle=useCallback(function(){var title='';var file=formik.values.file;if(file){if(file.type.indexOf('image')!==-1){title=t('send_photo');}}return title;},[formik,t]);var handleGetFile=function handleGetFile(file){formik.setFieldValue('file',file);setModalIsOpen(true);};useEffect(function(){if(clicked){inputRef.current.blur();setIosHeight(0);}},[clicked]);return{handleFocus:handleFocus,uploadRef:uploadRef,inputRef:inputRef,formik:formik,inputWrapperRef:inputWrapperRef,iosHeight:iosHeight,setModalIsOpen:setModalIsOpen,modalIsOpen:modalIsOpen,handleCancelModal:handleCancelModal,getTitle:getTitle,handleGetFile:handleGetFile};}","map":null,"metadata":{},"sourceType":"module"}