{"ast":null,"code":"import _toConsumableArray from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{creatingPostMediaMount,creatingPostMount,deleteUnCreatedPostMediaMount,postMediaPercentCompletedMount,resetAllTapeWithTokenMount,resetPostMedia,tapeLikeMount,tapeRemoveLikesMount}from'./events';import{combine,createStore}from'effector';import{commonStoreList}from'../../utils/store-utils';import{fetchAllTape,fetchAuthorTape,fetchCreatingPost,fetchCreatingPostMedia,fetchDeletePost}from'./effects';import{subscribeToUserMount}from'../user-model';import{fetchSubscribeToUser}from'../user-model/effects';var $authorTape=createStore({loading:false,data:[],result:{},forceLoading:0,error:false}).on(fetchAuthorTape.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAuthorTape.fail,function(state,_ref){var error=_ref.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:[],result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAuthorTape.done,function(state,_ref2){var result=_ref2.result,params=_ref2.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(tapeLikeMount,function(state,params){var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var oldData=data[author][idx];data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:true,likes_count:oldData.block_data.likes_count+1})})],_toConsumableArray(data[author].slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(tapeRemoveLikesMount,function(state,params){var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var oldData=data[author][idx];if(idx!==-1){data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:false,likes_count:oldData.block_data.likes_count-1})})],_toConsumableArray(data[author].slice(idx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchDeletePost.done,function(state,_ref3){var params=_ref3.params;var post_id=params.post_id;var author=params.author;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});if(idx!==-1){data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),_toConsumableArray(data[author].slice(idx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(creatingPostMount,function(state,_ref4){var temp_data=_ref4.temp_data;var item_data=temp_data.item_data,author=temp_data.author;var data=_objectSpread({},state.data);var result=_objectSpread({},state.result);if(data[author]){data[author]=[item_data].concat(_toConsumableArray(data[author]));result[author]=_objectSpread(_objectSpread({},result[author]),{},{count:result[author].count+1});// if (action) {\n//     action()\n// }\n}return _objectSpread(_objectSpread({},state),{},{data:data,result:result});}).on(fetchCreatingPost.done,function(state,_ref5){var response=_ref5.result,temp_data=_ref5.params.temp_data;var author=temp_data.author,uuid=temp_data.uuid,action=temp_data.action;var data=_objectSpread({},state.data);if(data[author]){var idx=data[author].findIndex(function(item){return item.id===uuid;});var newItem=_objectSpread(_objectSpread({},data[author][idx]),response.data);data[author]=[].concat(_toConsumableArray(data[author].slice(0,idx)),[newItem],_toConsumableArray(data[author].slice(idx+1)));if(action){action(response.data.id);}}return _objectSpread(_objectSpread({},state),{},{data:data});});var $allTape=createStore({data:[],result:{},error:false,loading:false,forceLoading:0}).on(fetchAllTape.pending,function(state,loading){return _objectSpread(_objectSpread({},state),{},{loading:loading});}).on(fetchAllTape.fail,function(state,_ref6){var error=_ref6.error;return _objectSpread(_objectSpread({},state),{},{error:error,data:{},result:{},forceLoading:state.forceLoading===2?state.forceLoading:1});}).on(fetchAllTape.done,function(state,_ref7){var result=_ref7.result,params=_ref7.params;var processed=commonStoreList(_objectSpread({response:result.data,state:state,clear:params.clear},params.params));return _objectSpread(_objectSpread(_objectSpread({},state),processed),{},{forceLoading:2});}).on(subscribeToUserMount,function(state,params){var username=params.username;var data=_toConsumableArray(state.data);var usersBlockIdx=data.findIndex(function(item){return item.block_type&&item.block_type==='users';});if(usersBlockIdx!==-1){var idx=data[usersBlockIdx].block_data.findIndex(function(item){return item.username===username;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[usersBlockIdx].block_data[idx]),{},{subs:{subscribed:true,me:data[usersBlockIdx].block_data[idx].subs.me+1}});var innerData=[].concat(_toConsumableArray(data[usersBlockIdx].block_data.slice(0,idx)),[item],_toConsumableArray(data[usersBlockIdx].block_data.slice(idx+1)));data=[].concat(_toConsumableArray(state.data.slice(0,usersBlockIdx)),[_objectSpread(_objectSpread({},data[usersBlockIdx]),{},{block_data:innerData})],_toConsumableArray(state.data.slice(usersBlockIdx+1)));}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(tapeLikeMount,function(state,params){var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){var oldData=state.data[idx];newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:true,likes_count:oldData.block_data.likes_count+1})})],_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(tapeRemoveLikesMount,function(state,params){var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){var oldData=state.data[idx];newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),[_objectSpread(_objectSpread({},oldData),{},{block_data:_objectSpread(_objectSpread({},oldData.block_data),{},{is_liked:false,likes_count:oldData.block_data.likes_count-1})})],_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(fetchDeletePost.done,function(state,_ref8){var params=_ref8.params;var post_id=params.post_id;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_data)&&item.block_data.id===post_id;});var newData=state.data;if(idx!==-1){newData=[].concat(_toConsumableArray(state.data.slice(0,idx)),_toConsumableArray(state.data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:newData});}).on(creatingPostMount,function(state,_ref9){var temp_data=_ref9.temp_data;var item_data=temp_data.item_data;// if (action) {\n//     action()\n// }\nvar result=_objectSpread(_objectSpread({},state.result),{},{count:state.result.count+1});var data=[item_data].concat(_toConsumableArray(state.data));return _objectSpread(_objectSpread({},state),{},{data:data,result:result});}).on(fetchCreatingPost.done,function(state,_ref10){var response=_ref10.result,temp_data=_ref10.params.temp_data;var uuid=temp_data.uuid,action=temp_data.action;var data=state.data;var idx=data.findIndex(function(item){return item.block_data.id===uuid;});if(idx!==-1){var newItem=_objectSpread(_objectSpread({},data[idx]),response.data);data=[].concat(_toConsumableArray(data.slice(0,idx)),[newItem],_toConsumableArray(data.slice(idx+1)));if(!!action){action(response.data.id);}}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(fetchSubscribeToUser.done,function(state,_ref11){var _ref11$params=_ref11.params,username=_ref11$params.username,action=_ref11$params.action;var idx=state.data.findIndex(function(item){return!Array.isArray(item.block_type)&&item.block_type==='users';});var usersData=state.data[idx];var accountIdx=usersData.block_data.findIndex(function(item){return item.username===username;});if(idx&&accountIdx!==-1){console.log(state.data[idx].block_data[accountIdx]);// newData = [...state.data.slice(0, idx),\n//     [...state.data[idx].block_data.slice(0, accountIdx),\n//         {...state.data[idx].block_data[accountIdx].subs, subscribed: true},\n//         ...state.data[idx].block_data.slice(accountIdx + 1)],\n//     ...state.data.slice(idx + 1)]\n}return _objectSpread({},state);}).reset(resetAllTapeWithTokenMount);var $postMedia=createStore({data:[],error:false}).on(creatingPostMediaMount,function(state,payload){return _objectSpread(_objectSpread({},state),{},{data:[].concat(_toConsumableArray(state.data),[payload.obj])});}).on(fetchCreatingPostMedia.done,function(state,_ref12){var result=_ref12.result,params=_ref12.params;var data=_toConsumableArray(state.data);var obj=params.obj;var idx=data.findIndex(function(item){return item.id===obj.id;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[idx]),{},{id:result.data.id,percentCompleted:100});data=[].concat(_toConsumableArray(data.slice(0,idx)),[item],_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(postMediaPercentCompletedMount,function(state,payload){var data=_toConsumableArray(state.data);var id=payload.id,percentCompleted=payload.percentCompleted;var idx=data.findIndex(function(item){return item.id===id;});if(idx!==-1){var item=_objectSpread(_objectSpread({},data[idx]),{},{percentCompleted:percentCompleted===100?99:percentCompleted});data=[].concat(_toConsumableArray(data.slice(0,idx)),[item],_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).on(deleteUnCreatedPostMediaMount,function(state,params){var id=params.media_id;var data=state.data;var idx=data.findIndex(function(item){return item.id===id;});if(idx!==-1){data=[].concat(_toConsumableArray(data.slice(0,idx)),_toConsumableArray(data.slice(idx+1)));}return _objectSpread(_objectSpread({},state),{},{data:data});}).reset(resetPostMedia);export var $tapeModel=combine({$authorTape:$authorTape,$allTape:$allTape,$postMedia:$postMedia});","map":{"version":3,"sources":["/Users/zuhriddinkamilzanov/Desktop/tMed-mobile/src/Models/tape-model/stores.js"],"names":["creatingPostMediaMount","creatingPostMount","deleteUnCreatedPostMediaMount","postMediaPercentCompletedMount","resetAllTapeWithTokenMount","resetPostMedia","tapeLikeMount","tapeRemoveLikesMount","combine","createStore","commonStoreList","fetchAllTape","fetchAuthorTape","fetchCreatingPost","fetchCreatingPostMedia","fetchDeletePost","subscribeToUserMount","fetchSubscribeToUser","$authorTape","loading","data","result","forceLoading","error","on","pending","state","fail","done","params","processed","response","clear","post_id","author","idx","findIndex","item","Array","isArray","block_data","id","oldData","slice","is_liked","likes_count","temp_data","item_data","count","uuid","action","newItem","$allTape","username","usersBlockIdx","block_type","subs","subscribed","me","innerData","newData","usersData","accountIdx","console","log","reset","$postMedia","payload","obj","percentCompleted","media_id","$tapeModel"],"mappings":"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","sourcesContent":["import {\r\n    creatingPostMediaMount,\r\n    creatingPostMount,\r\n    deleteUnCreatedPostMediaMount,\r\n    postMediaPercentCompletedMount,\r\n    resetAllTapeWithTokenMount,\r\n    resetPostMedia,\r\n    tapeLikeMount,\r\n    tapeRemoveLikesMount\r\n} from './events'\r\nimport {combine, createStore} from 'effector'\r\nimport {commonStoreList} from '../../utils/store-utils'\r\nimport {fetchAllTape, fetchAuthorTape, fetchCreatingPost, fetchCreatingPostMedia, fetchDeletePost} from './effects'\r\nimport {subscribeToUserMount} from '../user-model'\r\nimport {fetchSubscribeToUser} from '../user-model/effects'\r\n\r\nconst $authorTape = createStore({loading: false, data: [], result: {}, forceLoading: 0, error: false})\r\n    .on(fetchAuthorTape.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAuthorTape.fail, (state, {error}) => ({\r\n        ...state, error, data: [], result: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchAuthorTape.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, ...params.params\r\n        })\r\n        return {...state, ...processed, forceLoading: 2}\r\n    })\r\n    .on(tapeLikeMount, (state, params) => {\r\n        const post_id = params.post_id\r\n        const author = params.author\r\n        const data = {...state.data}\r\n        \r\n        if (data[author]) {\r\n            const idx = data[author].findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n            const oldData = data[author][idx]\r\n            data[author] = [...data[author].slice(0, idx), {\r\n                ...oldData,\r\n                block_data: {...oldData.block_data, is_liked: true, likes_count: oldData.block_data.likes_count + 1}\r\n            }, ...data[author].slice(idx + 1)]\r\n        }\r\n        \r\n        return {\r\n            ...state, data\r\n        }\r\n    })\r\n    .on(tapeRemoveLikesMount, (state, params) => {\r\n        const post_id = params.post_id\r\n        const author = params.author\r\n        const data = {...state.data}\r\n        if (data[author]) {\r\n            const idx = data[author].findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n            const oldData = data[author][idx]\r\n            if (idx !== -1) {\r\n                data[author] = [...data[author].slice(0, idx), {\r\n                    ...oldData,\r\n                    block_data: {\r\n                        ...oldData.block_data,\r\n                        is_liked: false,\r\n                        likes_count: oldData.block_data.likes_count - 1\r\n                    }\r\n                }, ...data[author].slice(idx + 1)]\r\n            }\r\n        }\r\n        return {\r\n            ...state, data\r\n        }\r\n    })\r\n    .on(fetchDeletePost.done, (state, {params}) => {\r\n        const post_id = params.post_id\r\n        const author = params.author\r\n        const data = {...state.data}\r\n        if (data[author]) {\r\n            const idx = data[author].findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n            if (idx !== -1) {\r\n                data[author] = [...data[author].slice(0, idx), ...data[author].slice(idx + 1)]\r\n            }\r\n        }\r\n        return {\r\n            ...state, data\r\n        }\r\n    })\r\n    .on(creatingPostMount, (state, {temp_data}) => {\r\n        const {item_data, author} = temp_data\r\n        const data = {...state.data}\r\n        const result = {...state.result}\r\n        \r\n        if (data[author]) {\r\n            data[author] = [item_data, ...data[author]]\r\n            result[author] = {...result[author], count: result[author].count + 1}\r\n            \r\n            // if (action) {\r\n            //     action()\r\n            // }\r\n        }\r\n        \r\n        return {...state, data, result}\r\n    })\r\n    .on(fetchCreatingPost.done, (state, {result: response, params: {temp_data}}) => {\r\n        const {author, uuid, action} = temp_data\r\n        const data = {...state.data}\r\n        \r\n        if (data[author]) {\r\n            const idx = data[author].findIndex(item => item.id === uuid)\r\n            const newItem = {...data[author][idx], ...response.data}\r\n            data[author] = [...data[author].slice(0, idx), newItem, ...data[author].slice(idx + 1)]\r\n            \r\n            if (action) {\r\n                action(response.data.id)\r\n            }\r\n        }\r\n        return {...state, data}\r\n    })\r\n\r\nconst $allTape = createStore({data: [], result: {}, error: false, loading: false, forceLoading: 0})\r\n    .on(fetchAllTape.pending, (state, loading) => ({...state, loading}))\r\n    .on(fetchAllTape.fail, (state, {error}) => ({\r\n        ...state, error, data: {}, result: {}, forceLoading: state.forceLoading === 2 ? state.forceLoading : 1\r\n    }))\r\n    .on(fetchAllTape.done, (state, {result, params}) => {\r\n        const processed = commonStoreList({\r\n            response: result.data, state, clear: params.clear, ...params.params\r\n        })\r\n        return {...state, ...processed, forceLoading: 2}\r\n    })\r\n    .on(subscribeToUserMount, (state, params) => {\r\n        const username = params.username\r\n        let data = [...state.data]\r\n        const usersBlockIdx = data.findIndex(item => item.block_type && item.block_type === 'users')\r\n        \r\n        if (usersBlockIdx !== -1) {\r\n            const idx = data[usersBlockIdx].block_data.findIndex(item => item.username === username)\r\n            if (idx !== -1) {\r\n                const item = {\r\n                    ...data[usersBlockIdx].block_data[idx], subs: {\r\n                        subscribed: true,\r\n                        me: data[usersBlockIdx].block_data[idx].subs.me + 1\r\n                    }\r\n                }\r\n                const innerData = [\r\n                    ...data[usersBlockIdx].block_data.slice(0, idx),\r\n                    item,\r\n                    ...data[usersBlockIdx].block_data.slice(idx + 1)\r\n                ]\r\n                data = [\r\n                    ...state.data.slice(0, usersBlockIdx),\r\n                    {...data[usersBlockIdx], block_data: innerData},\r\n                    ...state.data.slice(usersBlockIdx + 1)\r\n                ]\r\n            }\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(tapeLikeMount, (state, params) => {\r\n        const post_id = params.post_id\r\n        const idx = state.data.findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n        let newData = state.data\r\n        if (idx !== -1) {\r\n            const oldData = state.data[idx]\r\n            newData = [...state.data.slice(0, idx), {\r\n                ...oldData,\r\n                block_data: {...oldData.block_data, is_liked: true, likes_count: oldData.block_data.likes_count + 1}\r\n            }, ...state.data.slice(idx + 1)]\r\n        }\r\n        return {...state, data: newData}\r\n    })\r\n    .on(tapeRemoveLikesMount, (state, params) => {\r\n        const post_id = params.post_id\r\n        const idx = state.data.findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n        let newData = state.data\r\n        if (idx !== -1) {\r\n            const oldData = state.data[idx]\r\n            newData = [...state.data.slice(0, idx), {\r\n                ...oldData,\r\n                block_data: {...oldData.block_data, is_liked: false, likes_count: oldData.block_data.likes_count - 1}\r\n            }, ...state.data.slice(idx + 1)]\r\n        }\r\n        return {...state, data: newData}\r\n    })\r\n    .on(fetchDeletePost.done, (state, {params}) => {\r\n        const post_id = params.post_id\r\n        const idx = state.data.findIndex((item) => !Array.isArray(item.block_data) && item.block_data.id === post_id)\r\n        let newData = state.data\r\n        if (idx !== -1) {\r\n            newData = [...state.data.slice(0, idx), ...state.data.slice(idx + 1)]\r\n        }\r\n        return {...state, data: newData}\r\n    })\r\n    .on(creatingPostMount, (state, {temp_data}) => {\r\n        const {item_data} = temp_data\r\n        // if (action) {\r\n        //     action()\r\n        // }\r\n        const result = {...state.result, count: state.result.count + 1}\r\n        const data = [item_data, ...state.data]\r\n        return {...state, data, result}\r\n    })\r\n    .on(fetchCreatingPost.done, (state, {result: response, params: {temp_data}}) => {\r\n        const {uuid, action} = temp_data\r\n        let data = state.data\r\n        \r\n        const idx = data.findIndex(item => item.block_data.id === uuid)\r\n        \r\n        if (idx !== -1) {\r\n            const newItem = {...data[idx], ...response.data}\r\n            data = [...data.slice(0, idx), newItem, ...data.slice(idx + 1)]\r\n            \r\n            if (!!action) {\r\n                action(response.data.id)\r\n            }\r\n        }\r\n        \r\n        return {...state, data}\r\n    })\r\n    .on(fetchSubscribeToUser.done, (state, {params: {username, action}}) => {\r\n        const idx = state.data.findIndex((item) => !Array.isArray(item.block_type) && item.block_type === 'users')\r\n        const usersData = state.data[idx]\r\n        const accountIdx = usersData.block_data.findIndex(item => item.username === username)\r\n        \r\n        if (idx && accountIdx !== -1) {\r\n            console.log(state.data[idx].block_data[accountIdx])\r\n            // newData = [...state.data.slice(0, idx),\r\n            //     [...state.data[idx].block_data.slice(0, accountIdx),\r\n            //         {...state.data[idx].block_data[accountIdx].subs, subscribed: true},\r\n            //         ...state.data[idx].block_data.slice(accountIdx + 1)],\r\n            //     ...state.data.slice(idx + 1)]\r\n        }\r\n        \r\n        return {...state}\r\n    })\r\n    .reset(resetAllTapeWithTokenMount)\r\n\r\n\r\nconst $postMedia = createStore({data: [], error: false})\r\n    .on(creatingPostMediaMount, (state, payload) => {\r\n        return {\r\n            ...state,\r\n            data: [...state.data, payload.obj]\r\n        }\r\n    })\r\n    .on(fetchCreatingPostMedia.done, (state, {result, params}) => {\r\n        let data = [...state.data]\r\n        const {obj} = params\r\n        const idx = data.findIndex((item => item.id === obj.id))\r\n        if (idx !== -1) {\r\n            const item = {...data[idx], id: result.data.id, percentCompleted: 100}\r\n            data = [...data.slice(0, idx), item, ...data.slice(idx + 1)]\r\n        }\r\n        return {...state, data}\r\n    })\r\n    .on(postMediaPercentCompletedMount, (state, payload) => {\r\n        let data = [...state.data]\r\n        const {id, percentCompleted} = payload\r\n        const idx = data.findIndex((item => item.id === id))\r\n        if (idx !== -1) {\r\n            const item = {...data[idx], percentCompleted: percentCompleted === 100 ? 99 : percentCompleted}\r\n            data = [...data.slice(0, idx), item, ...data.slice(idx + 1)]\r\n        }\r\n        return {...state, data}\r\n    })\r\n    .on(deleteUnCreatedPostMediaMount, (state, params) => {\r\n        const id = params.media_id\r\n        let data = state.data\r\n        const idx = data.findIndex(item => item.id === id)\r\n        \r\n        if (idx !== -1) {\r\n            data = [...data.slice(0, idx), ...data.slice(idx + 1)]\r\n        }\r\n        return {...state, data: data}\r\n    })\r\n    .reset(resetPostMedia)\r\n\r\n\r\nexport const $tapeModel = combine({\r\n    $authorTape,\r\n    $allTape,\r\n    $postMedia\r\n})"]},"metadata":{},"sourceType":"module"}