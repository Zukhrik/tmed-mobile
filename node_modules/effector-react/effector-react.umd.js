((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector')):'function'==typeof define&&define.amd?define(['exports','react','effector'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).effectorReact={},e.React,e.effector)})(this,((e,t,effector)=>{function n(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function r(e){effector.is.store(e)||i('expect useStore argument to be a store');let t=e.getState(),n=f.default.useReducer((e=>e+1),0)[1],r=f.default.useRef({store:e,value:t,pending:0});return c((()=>{let t=e.updates.watch((e=>{let t=r.current;t.pending||(t.value=e,t.pending=1,n(),t.pending=0)})),o=e.getState(),a=r.current;return a.store===e&&a.value!==o&&(a.value=o,a.pending=1,n(),a.pending=0),a.store=e,t}),[e]),t}function o(e,t){let n,o,a,u;t?(n=t,a=e,u=[]):(n=e.fn,a=e.store,u=e.keys,o=e.updateFilter),effector.is.store(a)||i('useStoreMap expects a store'),Array.isArray(u)||i('useStoreMap expects an array as keys'),'function'!=typeof n&&i('useStoreMap expects a function');let s=f.default.useMemo((()=>effector.createStore(n(a.getState(),u),{updateFilter:o}).on(a,((e,t)=>n(t,u)))),u),l=r(s);return c((()=>()=>{s.off(a),effector.clearNode(s,{deep:1})}),u),l}function a(e,t){return t.displayName=e,t}function u(e,t){function n(e){let n=f.default.useRef(e),a=r(o);c((()=>(s({props:n.current,state:o.getState()}),()=>{l({props:n.current,state:o.getState()})})),[]);let u=t(e,a);return n.current=e,u}let o;effector.is.store(e)?o=e:'object'==typeof e&&null!==e?o=effector.combine(e):i('shape should be a store or object with stores');let u='Unknown';o&&o.shortName&&(u=o.shortName);let s=effector.createEvent(),l=effector.createEvent();return n.mounted=s,n.unmounted=l,a(`${u}.View`,n)}function s(e,t){return a(`Connect(${t.displayName||t.name||'Unknown'})`,(n=>f.default.createElement(t,Object.assign({},n,r(e)))))}function l(e,t={}){let n=f.default.useRef(null);c((()=>(e.open(n.current),()=>e.close(n.current))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(n.current,t)||(n.current=t,e.set(t))}var f=n(t);let c='undefined'!=typeof window?f.default.useLayoutEffect:f.default.useEffect,i=e=>{throw Error(e)};e.connect=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),s(t,n)},e.createComponent=u,e.createContextComponent=(e,t,n)=>a(`${e.shortName||'Unknown'}.ContextComponent`,(o=>{let a=f.default.useContext(t),u=r(e);return n(o,u,a)})),e.createGate=(e="gate",t={})=>{let n;return'object'==typeof e&&null!==e&&('defaultState'in e&&(t=e.defaultState),e.domain&&(n=e.domain),e=e.name),(({name:e="gate",domain:t,defaultState:n,hook:r})=>{function o(e){return r(o,e),null}let u=`${t?`${t.compositeName.fullName}/`:''}${e}`,s=effector.createEvent(`${u}.set`),l=effector.createEvent(`${u}.open`),f=effector.createEvent(`${u}.close`),c=effector.createStore(Boolean(0),{name:`${u}.status`}).on(l,(()=>Boolean(1))).on(f,(()=>Boolean(0))),i=effector.createStore(n,{name:`${u}.state`}).on(s,((e,t)=>t)).reset(f);if(t){let{hooks:e}=t;effector.launch({target:[e.store,e.store,e.event,e.event,e.event],params:[c,i,l,f,s]})}return o.open=l,o.close=f,o.status=c,o.state=i,o.set=s,a(`Gate:${u}`,o)})({name:e,domain:n,defaultState:t,hook:l})},e.createReactState=s,e.createStoreConsumer=e=>u(e,(({children:e},t)=>e(t))),e.useEvent=e=>e,e.useGate=l,e.useList=(e,t)=>{let n,u,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),n=t.fn,t.getKey&&(u=t.getKey)):n=t,effector.is.store(e)||i('expect useList first argument to be a store'),'function'!=typeof n&&i("expect useList's renderItem to be a function"),Array.isArray(s)||i("expect useList's keys to be an array");let l=f.default.useMemo((()=>{let t=a(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:n,keys:r,keyVal:a,value:u}=t;if(c.current[1])return c.current[0](u,a);let s=o({store:e,keys:[n,...r],fn:(e,t)=>e[t[0]]});return c.current[0](s,n)}));return f.default.memo(t)}),[e,!!u]),c=f.default.useRef([n,u]);c.current=[n,u];let d=f.default.useMemo((()=>s),s);if(u)return r(e).map((e=>{let t=c.current[1](e);return f.default.createElement(l,{keyVal:t,key:t,keys:d,value:e})}));{let t=o({store:e,keys:[e],fn:e=>e.length});return Array.from({length:t},((e,t)=>f.default.createElement(l,{index:t,key:t,keys:d})))}},e.useStore=r,e.useStoreMap=o,Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=effector-react.umd.js.map
